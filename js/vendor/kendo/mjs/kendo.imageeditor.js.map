{"version":3,"file":"kendo.imageeditor.js","names":["$","undefined$1","kendo","window","extend","Class","NS","paneStyles","round","f","Math","Pane","init","imageeditor","that","this","currentPaneTool","destroy","element","addClass","open","commonMessages","options","messages","common","paneWrapper","append","formWidget","ui","Form","formSettings","buttonsTemplate","html","renderButton","confirm","icon","themeColor","cancel","bindButtonEvents","show","buttons","find","_clickHandler","_click","bind","on","ev","action","target","closest","data","toolbar","trigger","console","error","refresh","off","hide","CropPane","fn","call","buildCropModel","canvasUI","model","_model","toJSON","executeCommand","command","cropMessages","panes","crop","aspectRatioItems","aspectRatioDS","key","push","value","text","formData","change","onChange","items","type","label","title","layout","grid","cols","gutter","aspectRatio","field","editor","editorOptions","dataValueField","dataTextField","dataSource","colSpan","orientation","_orientationEditor","width","attributes","style","format","max","min","height","lockAspectRatio","container","_orientationWidget","appendTo","kendoButtonGroup","portrait","selected","landscape","select","sender","wrapper","set","canvas","getCanvasElement","top","left","canvasContainer","cropOverlay","cropElement","handle","handles","zoomLevel","getZoomLevel","i","length","handleElm","attr","_initResizeHandle","_canvasUI","borderWidth","parseInt","css","backgroundImage","_image","src","backgroundSize","backgroundClip","backgroundPosition","kendoDraggable","ignore","drag","_adjustTopLeft","offsetTop","y","delta","offsetLeft","x","newModel","$target","oldModel","adjustments","correctedLeft","correctedTop","indexOf","offsetWidth","offsetHeight","compare","compareModel","maxWidth","maxHeight","originalRatio","gcd","_gcd","tempModel","newSize","_calcSize","force","size","isPortrait","ratios","split","map","wRatio","hRatio","expectedRatio","realRatio","sizeByRatio","a","b","remove","ResizePane","buildResizeModel","originalWidth","originalHeight","measure","resizeMessages","resize","encoded","pixels","percents","measureW","measureH","ratio","aspectRatioLocked","resetNumericsTo","_preventChange","widthNumeric","heightNumeric","isPercent","setOptions","ImageEditorPane","jQuery","imageeditorNS","Command","OpenPaneImageEditorCommand","exec","pane","first","ZoomImageEditorCommand","zoomStep","spacing","newHeight","imgHeight","currentZoom","zoomInOut","isNaN","_processStringValue","parseFloat","_canvas","_zoomLevel","initialZoom","expectedHeight","canvasWrapper","CropImageEditorCommand","ctx","getCurrent2dContext","croppedImage","getImageData","clearRect","putImageData","drawImage","toDataURL","done","image","drawCanvas","fail","ResizeImageEditorCommand","getCurrentImage","UndoImageEditorCommand","undoStack","pop","redoStack","RedoImageEditorCommand","SaveImageEditorCommand","saveAs","dataURI","OpenImageEditorCommand","upload","_upload","input","kendoUpload","onSelect","onError","multiple","validation","allowedExtensions","getKendoUpload","click","file","files","rawFile","reader","FileReader","addEventListener","result","_initUndoRedoStack","_toggleTools","readAsDataURL","ImageEditorCommand","commands","__meta__","id","name","category","depends","isPlainObject","Widget","outerHeight","_outerHeight","ERROR","IMAGELOADED","IMAGERENDERED","EXECUTE","CANVAS_TEMPLATE","imageEditorStyles","ImageEditor","_wrapper","_renderHeader","_contentWrapper","_keyHandler","imageUrl","_drawCanvas","notify","imageLabel","fileName","save","undo","redo","zoomIn","zoomOut","zoomDropdown","zoomActualSize","zoomFitToScreen","events","defaultTools","showText","toggleCondition","separator","separator1","overflow","component","componentOptions","placeholder","valuePrimitive","template","htmlEncode","commandOn","optionLabel","dataBound","e","list","_resizeHandler","onResize","header","_initToolbar","_tabIndex","toolbarElement","toolbarOptions","tools","Object","keys","parentMessages","ToolBar","toggleTools","_toolbarClick","val","contentWrapper","toolbarHeight","prevent","ctrlKey","keyCode","preventDefault","canRedo","canUndo","hasImage","canExport","enable","deferred","Deferred","Image","onload","progress","resolve","onerror","reject","arguments","promise","getContext","_ctx","args","commandName","commandOptions","plugin","kendo$1"],"sources":["kendo.imageeditor.js"],"mappings":"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","sourcesContent":["import './kendo.dropdownlist.js';\nimport './kendo.toolbar.js';\nimport './kendo.core.js';\nimport './kendo.form.js';\nimport './kendo.html.button.js';\nimport './kendo.buttongroup.js';\nimport './kendo.draganddrop.js';\nimport './kendo.upload.js';\n\n(function($, undefined$1) {\n    var kendo = window.kendo,\n        extend = $.extend,\n        Class = kendo.Class,\n\n        NS = \".k-imageeditor-pane\",\n\n        CLICK = \"click\";\n\n    var paneStyles = {\n        form: \"k-imageeditor-pane-form\",\n        button: \"k-imageeditor-pane-button\",\n        confirmButton: \"k-imageeditor-pane-confirm-button\",\n        cropOverlay: \"k-imageeditor-crop-overlay\",\n        crop: \"k-imageeditor-crop\",\n        resizeHandle: \"k-resize-handle\",\n        resizeHandlePrefix: \"k-resize-\"\n    };\n\n    var round = function(f) {\n        return Math.round(f * 1000) / 1000;\n    };\n\n    var Pane = Class.extend({\n        init: function(imageeditor) {\n            var that = this;\n\n            that.imageeditor = imageeditor;\n\n            if (that.imageeditor.currentPaneTool) {\n                that.imageeditor.currentPaneTool.destroy();\n            }\n\n            that.element = $(\"<div role='form' aria-label='Image edit pane.'></div>\").addClass(paneStyles.form);\n        },\n        open: function() {\n            var that = this,\n                imageeditor = that.imageeditor,\n                commonMessages = imageeditor.options.messages.common;\n\n            imageeditor.paneWrapper.append(that.element);\n            that.formWidget = new kendo.ui.Form(that.element, extend(that.formSettings(), {\n                buttonsTemplate: () =>\n                    kendo.html.renderButton(`<button class='${paneStyles.button} ${paneStyles.confirmButton}' data-action='confirm'>${commonMessages.confirm}</button>`, {\n                        icon: 'check',\n                        themeColor: 'primary'\n                    }) +\n                    kendo.html.renderButton(`<button class='${paneStyles.button}' data-action='cancel'>${commonMessages.cancel}</button>`, {\n                        icon: 'cancel-outline'\n                    })\n            }));\n\n            that.bindButtonEvents();\n            imageeditor.paneWrapper.show();\n            imageeditor.currentPaneTool = that;\n        },\n        bindButtonEvents: function() {\n            var that = this,\n                formWidget = that.formWidget,\n                buttons = formWidget.element.find(\".\" + paneStyles.button);\n\n            that._clickHandler = that._click.bind(that);\n\n            buttons.on(CLICK + NS, that._clickHandler);\n        },\n        _click: function(ev) {\n            var that = this,\n                target = $(ev.target).closest(\".\" + paneStyles.button),\n                action = target.data(\"action\");\n\n            if (that[action]) {\n                that[action]();\n            }\n        },\n        cancel: function() {\n            this.imageeditor.toolbar.element.find(\"[tabindex=0]\").trigger(\"focus\");\n            this.destroy();\n        },\n        confirm: function() {\n            window.console.error(\"Pane's confirm method is not implemented!\");\n            this.destroy();\n        },\n        refresh: function() {\n        },\n        destroy: function() {\n            var that = this,\n                imageeditor = that.imageeditor;\n\n            that.formWidget.element.find(\".\" + paneStyles.button).off(NS);\n            that.formWidget.destroy();\n            imageeditor.paneWrapper.html(\"\");\n            imageeditor.paneWrapper.hide();\n            delete imageeditor.currentPaneTool;\n        }\n    });\n\n    var CropPane = Pane.extend({\n        init: function(imageeditor) {\n            var that = this;\n            Pane.fn.init.call(that, imageeditor);\n            that.buildCropModel();\n            that.canvasUI();\n        },\n        confirm: function() {\n            var that = this,\n                model = that.formWidget._model.toJSON();\n\n            that.destroy();\n\n            that.imageeditor.executeCommand({ command: \"CropImageEditorCommand\", options: model });\n        },\n        formSettings: function() {\n            var that = this,\n                cropMessages = that.imageeditor.options.messages.panes.crop,\n                commonMessages = that.imageeditor.options.messages.common,\n                aspectRatioItems = cropMessages.aspectRatioItems,\n                aspectRatioDS = [];\n\n            if (aspectRatioItems) {\n                for (var key in aspectRatioItems) {\n                    aspectRatioDS.push({ value: key, text: aspectRatioItems[key] });\n                }\n            } else {\n                aspectRatioDS = [\n                    { value: \"originalRatio\", text: \"Original ratio\" },\n                    { value: \"1:1\", text: \"1:1 (Square)\" },\n                    { value: \"4:5\", text: \"4:5 (8:10)\" },\n                    { value: \"5:7\", text: \"5:7\" },\n                    { value: \"2:3\", text: \"2:3 (4:6)\" },\n                    { value: \"16:9\", text: \"16:9\" }\n                ];\n            }\n\n            return {\n                formData: that._model,\n                change: that.onChange.bind(that),\n                items: [{\n                    type: \"group\",\n                    label: cropMessages.title || \"Crop Image\",\n                    layout: \"grid\",\n                    grid: { cols: 2, gutter: \"0 8px\" },\n                    items: [{\n                            label: cropMessages.aspectRatio || \"Aspect ratio:\",\n                            field: \"aspectRatio\",\n                            editor: \"DropDownList\",\n                            editorOptions: {\n                                dataValueField: \"value\",\n                                dataTextField: \"text\",\n                                dataSource: aspectRatioDS\n                            },\n                            colSpan: 2\n                        }, {\n                            label: cropMessages.orientation,\n                            field: \"orientation\",\n                            editor: that._orientationEditor.bind(that),\n                            colSpan: 2\n                        }, {\n                            label: commonMessages.width || \"Width:\",\n                            field: \"width\",\n                            attributes: { style: \"max-width: 100px;\" },\n                            editor: \"NumericTextBox\",\n                            editorOptions: {\n                                format: \"n0\",\n                                max: that._model.width,\n                                min: 0\n                            },\n                            colSpan: 1\n                        }, {\n                            label: commonMessages.height || \"Height:\",\n                            field: \"height\",\n                            attributes: { style: \"max-width: 100px;\" },\n                            editor: \"NumericTextBox\",\n                            editorOptions: {\n                                format: \"n0\",\n                                max: that._model.height,\n                                min: 0\n                            },\n                            colSpan: 1\n                        }, {\n                            label: commonMessages.lockAspectRatio || \"Lock aspect ratio\",\n                            field: \"lockAspectRatio\",\n                            colSpan: 2\n                        }\n                    ]\n                }]\n            };\n        },\n        _orientationEditor: function(container, options) {\n            var that = this,\n                cropMessages = that.imageeditor.options.messages.panes.crop,\n                value = options.model[options.field];\n\n            that._orientationWidget = $(\"<div name='\" + options.field + \"'></div>\")\n                .appendTo(container)\n                .kendoButtonGroup({\n                    items: [\n                        { text: cropMessages.portrait || \"Portrait\", attributes: { \"data-value\": \"portrait\" }, selected: value === \"portrait\" },\n                        { text: cropMessages.landscape || \"Landscape\", attributes: { \"data-value\": \"landscape\" }, selected: value === \"landscape\" }\n                    ],\n                    select: function(ev) {\n                        var value = ev.sender.wrapper.find(\".k-selected\").data(\"value\");\n                        options.model.set(options.field, value);\n                    }\n                }).data(\"kendoButtonGroup\");\n        },\n        buildCropModel: function() {\n            var that = this,\n                imageeditor = that.imageeditor,\n                canvas = imageeditor.getCanvasElement(),\n                width = canvas.width,\n                height = canvas.height;\n\n                that._model = {\n                    top: 0,\n                    left: 0,\n                    aspectRatio: \"originalRatio\",\n                    width: width,\n                    height: height,\n                    orientation: (width - height < 0) ? \"portrait\" : \"landscape\",\n                    lockAspectRatio: true\n                };\n        },\n        canvasUI: function() {\n            var that = this,\n                imageeditor = that.imageeditor,\n                canvasContainer = that.imageeditor.canvasContainer,\n                cropOverlay = $(\"<div></div>\").addClass(paneStyles.cropOverlay),\n                cropElement = $(\"<div></div>\").addClass(paneStyles.crop),\n                handle = \"<span class='\" + paneStyles.resizeHandle + \"'></span>\",\n                handles = [ \"nw\", \"n\", \"ne\", \"w\", \"e\", \"sw\", \"s\", \"se\" ],\n                zoomLevel = imageeditor.getZoomLevel();\n\n            for (var i = 0; i < handles.length; i++) {\n                var handleElm = $(handle)\n                    .addClass(paneStyles.resizeHandlePrefix + handles[i])\n                    .attr(\"data-orientation\", handles[i]);\n\n                that._initResizeHandle(handleElm);\n\n                cropElement.append(handleElm);\n            }\n\n            that.cropElement = cropElement;\n\n            that._canvasUI = cropOverlay\n                .append(cropElement)\n                .appendTo(canvasContainer);\n\n            var width = Math.round(that._model.width * zoomLevel);\n            var height = Math.round(that._model.height * zoomLevel);\n            var borderWidth = parseInt(that.cropElement.css(\"border-top-width\"), 10);\n\n            that.cropElement.css({\n                width: width,\n                height: height,\n                backgroundImage: \"url('\" + imageeditor._image.src + \"')\",\n                backgroundSize: kendo.format(\"{0}px {1}px\", width, height),\n                backgroundClip: \"content-box\",\n                backgroundPosition: kendo.format(\"-{0}px -{0}px\", borderWidth)\n            });\n\n            that.cropElement.kendoDraggable({\n                ignore: \".\" + paneStyles.resizeHandle,\n                drag: function(ev) {\n                    that._adjustTopLeft(ev.target.offsetTop + ev.y.delta, ev.target.offsetLeft + ev.x.delta);\n                }\n            });\n        },\n        refresh: function() {\n            var that = this,\n                newModel = that.formWidget._model,\n                zoomLevel = that.imageeditor.getZoomLevel(),\n                width = Math.round(newModel.width * zoomLevel),\n                height = Math.round(newModel.height * zoomLevel),\n                top = Math.round(newModel.top * zoomLevel),\n                left = Math.round(newModel.left * zoomLevel),\n                borderWidth = parseInt(that.cropElement.css(\"border-top-width\"), 10);\n\n            that.cropElement.css({\n                top: top,\n                left: left,\n                width: width,\n                height: height,\n                backgroundSize: kendo.format(\"{0}px {1}px\", that._model.width * zoomLevel, that._model.height * zoomLevel),\n                backgroundPosition: kendo.format(\"-{0}px -{1}px\", left + borderWidth, top + borderWidth)\n            });\n        },\n        _initResizeHandle: function(handle) {\n            var that = this;\n\n            handle.kendoDraggable({\n                drag: function(ev) {\n                    var $target = $(ev.sender.element),\n                        newModel = that.formWidget._model,\n                        oldModel = that._model,\n                        orientation = $target.data(\"orientation\"),\n                        adjustments = {},\n                        zoomLevel = that.imageeditor.getZoomLevel(),\n                        correctedLeft = newModel.left * zoomLevel,\n                        correctedTop = newModel.top * zoomLevel;\n\n                    if (orientation.indexOf(\"w\") >= 0) {\n                        adjustments.left = that.cropElement[0].offsetLeft + ev.x.delta;\n                        adjustments.width = that.cropElement[0].offsetWidth - ev.x.delta;\n                    } else if (orientation.indexOf(\"e\") >= 0) {\n                        adjustments.width = that.cropElement[0].offsetWidth + ev.x.delta;\n                    }\n\n                    if (orientation.indexOf(\"n\") >= 0) {\n                        adjustments.top = that.cropElement[0].offsetTop + ev.y.delta;\n                        adjustments.height = that.cropElement[0].offsetHeight - ev.y.delta;\n                    } else if (orientation.indexOf(\"s\") >= 0) {\n                        adjustments.height = that.cropElement[0].offsetHeight + ev.y.delta;\n                    }\n\n                    if (adjustments.width && ((adjustments.left || correctedLeft) + adjustments.width <= oldModel.width * zoomLevel)) {\n                        newModel.set(\"width\", Math.round(adjustments.width / zoomLevel));\n                    }\n\n                    if (adjustments.height && ((adjustments.top || correctedTop) + adjustments.height <= oldModel.height * zoomLevel)) {\n                        newModel.set(\"height\", Math.round(adjustments.height / zoomLevel));\n                    }\n\n                    if (adjustments.top || adjustments.left) {\n                        that._adjustTopLeft(adjustments.top, adjustments.left);\n                    }\n                }\n            });\n        },\n        _adjustTopLeft: function(top, left, compare) {\n            var that = this,\n                compareModel = compare || that.formWidget._model,\n                newModel = that.formWidget._model,\n                oldModel = that._model,\n                zoomLevel = that.imageeditor.getZoomLevel();\n\n            if (top >= 0 && (top / zoomLevel) + compareModel.height <= oldModel.height) {\n                newModel.set(\"top\", Math.round(top / zoomLevel));\n            }\n\n            if (left >= 0 && (left / zoomLevel) + compareModel.width <= oldModel.width) {\n                newModel.set(\"left\", Math.round(left / zoomLevel));\n            }\n        },\n        onChange: function(ev) {\n            var that = this,\n                zoomLevel = that.imageeditor.getZoomLevel(),\n                newModel = ev.sender._model,\n                oldModel = that._model,\n                maxWidth = oldModel.width,\n                maxHeight = oldModel.height,\n                originalRatio = oldModel.width + \":\" + oldModel.height,\n                gcd = that._gcd(oldModel.width, oldModel.height);\n\n            originalRatio = oldModel.width / gcd + \":\" + oldModel.height / gcd;\n\n            if (ev.field === \"aspectRatio\" && ev.value === \"originalRatio\") {\n                newModel.set(\"top\", 0);\n                newModel.set(\"left\", 0);\n                newModel.set(\"orientation\", oldModel.orientation);\n                newModel.set(\"width\", oldModel.width);\n                newModel.set(\"height\", oldModel.height);\n            } else if (ev.field === \"orientation\") {\n                var tempModel = extend({}, newModel, {\n                    width: newModel.height,\n                    height: newModel.width\n                });\n\n                var newSize = that._calcSize(tempModel, originalRatio, maxWidth, maxHeight);\n\n                newModel.set(\"width\", newSize.width);\n                newModel.set(\"height\", newSize.height);\n                that._orientationWidget.select(ev.value === \"portrait\" ? 0 : 1);\n            } else if (newModel.lockAspectRatio) {\n                var force = ev.field;\n                var size = that._calcSize(newModel, originalRatio, maxWidth, maxHeight, force);\n                newModel.set(\"width\", size.width);\n                newModel.set(\"height\", size.height);\n            }\n\n            var width = Math.round(newModel.width * zoomLevel);\n            var height = Math.round(newModel.height * zoomLevel);\n            var top = Math.round(newModel.top * zoomLevel);\n            var left = Math.round(newModel.left * zoomLevel);\n            var borderWidth = parseInt(that.cropElement.css(\"border-top-width\"), 10);\n\n            that.cropElement.css({\n                top: top,\n                left: left,\n                width: width,\n                height: height,\n                backgroundPosition: kendo.format(\"-{0}px -{1}px\", left + borderWidth, top + borderWidth)\n            });\n        },\n        _calcSize: function(model, originalRatio, maxWidth, maxHeight, force) {\n            var width = Math.min(model.width, maxWidth),\n                height = Math.min(model.height, maxHeight),\n                isPortrait = model.orientation === \"portrait\",\n                ratios = model.aspectRatio;\n\n            if (ratios.indexOf(\":\") < 0) {\n                ratios = originalRatio;\n            }\n\n            ratios = ratios.split(\":\").map(function(value) {\n                return parseInt(value, 10);\n            });\n\n            var wRatio = isPortrait ? Math.min(ratios[0], ratios[1]) : Math.max(ratios[0], ratios[1]);\n            var hRatio = !isPortrait ? Math.min(ratios[0], ratios[1]) : Math.max(ratios[0], ratios[1]);\n            var expectedRatio = round(wRatio / hRatio);\n            var realRatio = round(width / height);\n\n            var sizeByRatio = {\n                width: Math.round(height * expectedRatio),\n                height: Math.round(width / expectedRatio)\n            };\n\n            if (force === \"width\") {\n                return {\n                    width: width,\n                    height: sizeByRatio.height\n                };\n            }\n\n            if (force === \"height\") {\n                return {\n                    width: sizeByRatio.width,\n                    height: height\n                };\n            }\n\n            if (realRatio > expectedRatio) {\n                width = sizeByRatio.width;\n            } else if (realRatio < expectedRatio) {\n                height = sizeByRatio.height;\n            }\n\n            return {\n                width: width,\n                height: height\n            };\n        },\n        _gcd: function(a, b) {\n            return (b === 0) ? a : this._gcd (b, a % b);\n        },\n        destroy: function() {\n            kendo.destroy(this._canvasUI);\n            this._canvasUI.remove();\n            Pane.fn.destroy.call(this);\n        }\n    });\n\n    var ResizePane = Pane.extend({\n        init: function(imageeditor) {\n            Pane.fn.init.call(this, imageeditor);\n            this.buildResizeModel();\n        },\n        confirm: function() {\n            var that = this,\n                originalWidth = that._model.width,\n                originalHeight = that._model.height,\n                model = that.formWidget._model.toJSON();\n\n            if (model.measure === \"percents\") {\n                model.width = originalWidth * (model.width / 100);\n                model.height = originalHeight * (model.height / 100);\n            }\n\n            that.imageeditor.executeCommand({ command: \"ResizeImageEditorCommand\", options: model });\n            that.destroy();\n        },\n        formSettings: function() {\n            var that = this,\n                resizeMessages = that.imageeditor.options.messages.panes.resize,\n                commonMessages = that.imageeditor.options.messages.common;\n\n            return {\n                formData: that._model,\n                change: that.onChange.bind(that),\n                items: [{\n                    type: \"group\",\n                    label: resizeMessages.title || \"Resize image\",\n                    layout: \"grid\",\n                    grid: { cols: 2, gutter: \"0 8px\" },\n                    items: [{\n                        label: commonMessages.width || \"Width:\",\n                        field: \"width\",\n                        attributes: { style: \"max-width: 100px;\" },\n                        editor: \"NumericTextBox\",\n                        editorOptions: {\n                            format: \"n0\",\n                            min: 0\n                        },\n                        colSpan: 1\n                    }, {\n                        field: \"measureW\",\n                        editor: \"DropDownList\",\n                        attributes: { style: \"max-width: 100px;\" },\n                        label: { text: \"&nbsp;\", encoded: false },\n                        editorOptions: {\n                            dataTextField: \"text\",\n                            dataValueField: \"value\",\n                            dataSource: [\n                                { text: resizeMessages.pixels || \"Pixels\", value: \"pixels\" },\n                                { text: resizeMessages.percents || \"Percents\", value: \"percents\" }\n                            ]\n                        },\n                        colSpan: 1\n                    }, {\n                        label: commonMessages.height || \"Height:\",\n                        field: \"height\",\n                        attributes: { style: \"max-width: 100px;\" },\n                        editor: \"NumericTextBox\",\n                        editorOptions: {\n                            format: \"n0\",\n                            min: 0\n                        },\n                        colSpan: 1\n                    }, {\n                        field: \"measureH\",\n                        label: { text: \"&nbsp;\", encoded: false },\n                        attributes: { style: \"max-width: 100px;\" },\n                        editor: \"DropDownList\",\n                        editorOptions: {\n                            dataTextField: \"text\",\n                            dataValueField: \"value\",\n                            dataSource: [\n                                { text: resizeMessages.pixels || \"Pixels\", value: \"pixels\" },\n                                { text: resizeMessages.percents || \"Percents\", value: \"percents\" }\n                            ]\n                        },\n                        colSpan: 1\n                    }, {\n                        label: commonMessages.lockAspectRatio || \"Lock aspect ratio\",\n                        field: \"lockAspectRatio\",\n                        colSpan: 2\n                    }]\n                }]\n            };\n        },\n        buildResizeModel: function() {\n            var that = this,\n                imageeditor = that.imageeditor,\n                canvas = imageeditor.getCanvasElement(),\n                width = canvas.width,\n                height = canvas.height;\n\n                that._model = {\n                    width: width,\n                    height: height,\n                    measure: \"pixels\",\n                    measureW: \"pixels\",\n                    measureH: \"pixels\",\n                    lockAspectRatio: true,\n                    ratio: round(width / height)\n                };\n        },\n        onChange: function(ev) {\n            var that = this,\n                newModel = ev.sender._model,\n                aspectRatioLocked = newModel.lockAspectRatio;\n\n            if (ev.field === \"measureW\" || ev.field === \"measureH\") {\n                newModel.set(\"measureW\", ev.value);\n                newModel.set(\"measureH\", ev.value);\n                newModel.set(\"measure\", ev.value);\n            } else if (ev.field === \"measure\") {\n                that.resetNumericsTo(ev.value);\n            } else if (ev.field === \"width\" && aspectRatioLocked && !that._preventChange) {\n                newModel.set(\"height\", newModel.width / newModel.ratio);\n            } else if (ev.field === \"height\" && aspectRatioLocked && !that._preventChange) {\n                newModel.set(\"width\", newModel.height * newModel.ratio);\n            }\n\n            newModel.set(\"ratio\", round(newModel.width / newModel.height));\n        },\n        resetNumericsTo: function(type) {\n            var that = this,\n                originalWidth = that._model.width,\n                originalHeight = that._model.height,\n                formWidget = that.formWidget,\n                model = formWidget._model,\n                widthNumeric = formWidget.element.find(\"[name=width]\").data(\"kendoNumericTextBox\"),\n                heightNumeric = formWidget.element.find(\"[name=height]\").data(\"kendoNumericTextBox\"),\n                isPercent = type === \"percents\",\n                options = {\n                    percents: {\n                        format: \"#\\\\\\%\"\n                    },\n                    pixels: {\n                        format: \"n0\"\n                    }\n                };\n\n\n            widthNumeric.setOptions(options[type]);\n            heightNumeric.setOptions(options[type]);\n\n            that._preventChange = true;\n            model.set(\"width\", isPercent ? (originalWidth / widthNumeric.value()) * 100 : originalWidth * (widthNumeric.value() / 100));\n            model.set(\"height\", isPercent ? (originalHeight / heightNumeric.value()) * 100 : originalHeight * (heightNumeric.value() / 100));\n            that._preventChange = false;\n        }\n    });\n\n    extend(kendo.ui, {\n        imageeditor: {\n            ImageEditorPane: Pane,\n            panes: {\n                crop: CropPane,\n                resize: ResizePane\n            }\n        }\n    });\n})(window.kendo.jQuery);\n\n(function($, undefined$1) {\n    var kendo = window.kendo,\n        imageeditorNS = kendo.ui.imageeditor,\n        extend = $.extend,\n        Class = kendo.Class;\n\n    var Command = Class.extend({\n        init: function(options) {\n            this.options = extend({}, options, this.options);\n            this.imageeditor = options.imageeditor;\n        }\n    });\n\n    var OpenPaneImageEditorCommand = Command.extend({\n        init: function(options) {\n            Command.fn.init.call(this, options);\n        },\n        exec: function() {\n            var that = this,\n                imageeditor = that.imageeditor,\n                pane = new imageeditorNS.panes[that.options.value](imageeditor);\n\n                pane.open();\n                pane.element.find(\":kendoFocusable\").first().trigger(\"focus\");\n        }\n    });\n\n    var ZoomImageEditorCommand = Command.extend({\n        options: {\n            zoomStep: 0.05,\n            spacing: 20\n        },\n        init: function(options) {\n            Command.fn.init.call(this, options);\n        },\n        exec: function() {\n            var that = this,\n                options = that.options,\n                value = options.value,\n                imageeditor = that.imageeditor,\n                imgHeight = imageeditor._image.height,\n                currentZoom = imageeditor.getZoomLevel(),\n                newHeight = imgHeight,\n                zoomInOut = value === \"zoomIn\" || value === \"zoomOut\";\n\n                if (!isNaN(value)) {\n                    value = parseFloat(value);\n                } else if (typeof value === \"string\") {\n                    value = that._processStringValue(value, currentZoom);\n                }\n\n                newHeight = Math.round(imgHeight * value);\n\n                if (newHeight > 0) {\n                    $(imageeditor._canvas).css(\"height\", newHeight);\n                    imageeditor._zoomLevel = value;\n                }\n\n                if (imageeditor.currentPaneTool) {\n                    imageeditor.currentPaneTool.refresh();\n                }\n\n                if (zoomInOut) {\n                    imageeditor.toolbar.element.find(\"[tabindex=0]\").trigger(\"focus\");\n                }\n        },\n        _processStringValue: function(value, initialZoom) {\n            var that = this,\n                options = that.options,\n                imageeditor = that.imageeditor,\n                imgHeight = imageeditor._image.height,\n                expectedHeight = imageeditor.canvasWrapper.height() - options.spacing,\n                zoomStep = options.zoomStep;\n\n            switch (value) {\n                case \"zoomIn\":\n                    return initialZoom + zoomStep;\n                case \"zoomOut\":\n                    return initialZoom - zoomStep;\n                case \"fitToScreen\":\n                    return Math.round((expectedHeight / imgHeight) * 100) / 100;\n                default:\n                    return 1;\n            }\n        }\n    });\n\n    var CropImageEditorCommand = Command.extend({\n        init: function(options) {\n            Command.fn.init.call(this, options);\n        },\n        exec: function() {\n            var that = this,\n                options = that.options,\n                imageeditor = that.imageeditor,\n                canvas = imageeditor.getCanvasElement(),\n                ctx = imageeditor.getCurrent2dContext(),\n                croppedImage = ctx.getImageData(options.left, options.top, options.width, options.height);\n\n            ctx.clearRect(0, 0, canvas.width, canvas.height);\n            canvas.width = options.width;\n            canvas.height = options.height;\n            ctx.putImageData(croppedImage, 0, 0);\n\n            imageeditor.drawImage(canvas.toDataURL()).done(function(image) {\n                imageeditor.drawCanvas(image);\n                imageeditor.toolbar.element.find(\"[tabindex=0]\").trigger(\"focus\");\n            }).fail(function(ev) {\n                imageeditor.trigger(\"error\", ev);\n            });\n        }\n    });\n\n    var ResizeImageEditorCommand = Command.extend({\n        init: function(options) {\n            Command.fn.init.call(this, options);\n        },\n        exec: function() {\n            var that = this,\n                options = that.options,\n                imageeditor = that.imageeditor,\n                canvas = imageeditor.getCanvasElement(),\n                ctx = imageeditor.getCurrent2dContext(),\n                image = imageeditor.getCurrentImage();\n\n            ctx.clearRect(0, 0, canvas.width, canvas.height);\n            canvas.width = options.width;\n            canvas.height = options.height;\n            ctx.drawImage(image, 0, 0, options.width, options.height);\n\n            imageeditor.drawImage(canvas.toDataURL()).done(function(image) {\n                imageeditor.drawCanvas(image);\n                imageeditor.toolbar.element.find(\"[tabindex=0]\").trigger(\"focus\");\n            }).fail(function(ev) {\n                imageeditor.trigger(\"error\", ev);\n            });\n        }\n    });\n\n    var UndoImageEditorCommand = Command.extend({\n        exec: function() {\n            var that = this,\n                imageeditor = that.imageeditor,\n                canvas = imageeditor.getCanvasElement(),\n                ctx = imageeditor.getCurrent2dContext(),\n                image = imageeditor.undoStack.pop();\n\n            if (image) {\n                imageeditor.redoStack.push(imageeditor.getCurrentImage());\n                delete imageeditor._image;\n\n                ctx.clearRect(0, 0, canvas.width, canvas.height);\n                canvas.width = image.width;\n                canvas.height = image.height;\n                ctx.drawImage(image, 0, 0, image.width, image.height);\n\n                imageeditor.drawImage(canvas.toDataURL()).done(function(image) {\n                    imageeditor.drawCanvas(image);\n                    imageeditor.toolbar.element.find(\"[tabindex=0]\").trigger(\"focus\");\n                }).fail(function(ev) {\n                    imageeditor.trigger(\"error\", ev);\n                });\n            }\n        }\n    });\n\n    var RedoImageEditorCommand = Command.extend({\n        exec: function() {\n            var that = this,\n                imageeditor = that.imageeditor,\n                canvas = imageeditor.getCanvasElement(),\n                ctx = imageeditor.getCurrent2dContext(),\n                image = imageeditor.redoStack.pop();\n\n            if (image) {\n                imageeditor.undoStack.push(imageeditor.getCurrentImage());\n                delete imageeditor._image;\n\n                ctx.clearRect(0, 0, canvas.width, canvas.height);\n                canvas.width = image.width;\n                canvas.height = image.height;\n                ctx.drawImage(image, 0, 0, image.width, image.height);\n\n                imageeditor.drawImage(canvas.toDataURL()).done(function(image) {\n                    imageeditor.drawCanvas(image);\n                    imageeditor.toolbar.element.find(\"[tabindex=0]\").trigger(\"focus\");\n                }).fail(function(ev) {\n                    imageeditor.trigger(\"error\", ev);\n                });\n            }\n        }\n    });\n\n    var SaveImageEditorCommand = Command.extend({\n        exec: function() {\n            var that = this,\n                imageeditor = that.imageeditor,\n                canvas = imageeditor.getCanvasElement();\n\n            kendo.saveAs(extend({}, imageeditor.options.saveAs, {\n                dataURI: canvas.toDataURL()\n            }));\n\n            imageeditor.toolbar.element.find(\"[data-command=SaveImageEditorCommand]\").trigger(\"focus\");\n        }\n    });\n\n    var OpenImageEditorCommand = Command.extend({\n        exec: function() {\n            var that = this,\n                imageeditor = that.imageeditor,\n                upload = imageeditor._upload;\n\n            if (!upload) {\n                var input = $(\"<input type='file' />\");\n                input.kendoUpload({\n                    select: that.onSelect.bind(that),\n                    error: that.onError.bind(that),\n                    multiple: false,\n                    validation: {\n                        allowedExtensions: [\".jpg\", \".jpeg\", \".gif\", \".png\", \".bmp\", \".tiff\", \".webp\"]\n                    }\n                });\n\n                imageeditor._upload = upload = input.getKendoUpload();\n\n            }\n\n            upload.element.click();\n        },\n        onSelect: function(ev) {\n            var that = this,\n                imageeditor = that.imageeditor,\n                file = ev.files[0].rawFile,\n                reader = new FileReader();\n\n            reader.addEventListener(\"load\", function() {\n                imageeditor.drawImage(reader.result).done(function(image) {\n                    if (!imageeditor.trigger(\"imageLoaded\", { image: image })) {\n                        imageeditor.drawCanvas(image);\n                        imageeditor._initUndoRedoStack();\n                        imageeditor._toggleTools();\n                    }\n                }).fail(function(ev) {\n                    imageeditor.trigger(\"error\", ev);\n                });\n            }, false);\n\n\n            if (file) {\n                reader.readAsDataURL(file);\n            }\n\n        },\n        onError: function(ev) {\n            var that = this,\n                imageeditor = that.imageeditor;\n\n            imageeditor.trigger(\"error\", ev);\n        }\n    });\n\n    extend(kendo.ui.imageeditor, {\n        ImageEditorCommand: Command,\n        commands: {\n            OpenPaneImageEditorCommand: OpenPaneImageEditorCommand,\n            ZoomImageEditorCommand: ZoomImageEditorCommand,\n            CropImageEditorCommand: CropImageEditorCommand,\n            ResizeImageEditorCommand: ResizeImageEditorCommand,\n            UndoImageEditorCommand: UndoImageEditorCommand,\n            RedoImageEditorCommand: RedoImageEditorCommand,\n            SaveImageEditorCommand: SaveImageEditorCommand,\n            OpenImageEditorCommand: OpenImageEditorCommand\n        }\n    });\n\n})(window.kendo.jQuery);\n\nvar __meta__ = {\n    id: \"imageeditor\",\n    name: \"ImageEditor\",\n    category: \"web\",\n    depends: [\"core\", \"toolbar\", \"dropdownlist\"]\n};\n\n(function($, undefined$1) {\n    var kendo = window.kendo,\n        extend = $.extend,\n        isPlainObject = $.isPlainObject,\n        Widget = kendo.ui.Widget,\n        ui = kendo.ui,\n\n        NS = \".kendoImageEditor\",\n\n        outerHeight = kendo._outerHeight,\n\n        ERROR = \"error\",\n        IMAGELOADED = \"imageLoaded\",\n        IMAGERENDERED = \"imageRendered\",\n        EXECUTE = \"execute\",\n\n        CLICK = \"click\",\n        TOGGLE = \"toggle\",\n        CHANGE = \"change\",\n\n        CANVAS_TEMPLATE = (label) => `<canvas role='img' aria-label='${label}'>Canvas element</canvas>`;\n\n    var imageEditorStyles = {\n        wrapper: \"k-widget k-imageeditor\",\n        header: \"k-imageeditor-header\",\n        toolbar: \"k-imageeditor-toolbar\",\n        paneWrapper: \"k-imageeditor-action-pane\",\n        contentWrapper: \"k-imageeditor-content\",\n        canvasWrapper: \"k-imageeditor-canvas-container\",\n        canvasContainer: \"k-imageeditor-canvas\"\n    };\n\n    var ImageEditor = Widget.extend({\n        init: function(element, options) {\n            var that = this;\n\n            Widget.fn.init.call(that, element, options);\n            options = $.extend(true, {}, options);\n\n            that._wrapper();\n            that._renderHeader();\n            that._contentWrapper();\n            that._keyHandler();\n\n            if (options.imageUrl) {\n                that._drawCanvas();\n            }\n\n            that._initUndoRedoStack();\n            that._toggleTools();\n\n            kendo.notify(that);\n        },\n\n        options: {\n            name: 'ImageEditor',\n            width: \"100%\",\n            height: 570,\n            imageUrl: \"\",\n            imageLabel: \"\",\n            toolbar: {\n            },\n            saveAs: {\n                fileName: \"image.png\"\n            },\n            messages: {\n                toolbar: {\n                    open: \"Open Image\",\n                    save: \"Save Image\",\n                    undo: \"Undo\",\n                    redo: \"Redo\",\n                    crop: \"Crop\",\n                    resize: \"Resize\",\n                    zoomIn: \"Zoom In\",\n                    zoomOut: \"Zoom Out\",\n                    zoomDropdown: \"Zoom options\",\n                    zoomActualSize: \"Show actual size\",\n                    zoomFitToScreen: \"Fit to screen\"\n                },\n                panes: {\n                    crop: {\n                        title: \"Crop Image\",\n                        aspectRatio: \"Aspect Ratio:\",\n                        aspectRatioItems: {\n                            \"originalRatio\": \"Original ratio\",\n                            \"1:1\": \"1:1 (Square)\",\n                            \"4:5\": \"4:5 (8:10)\",\n                            \"5:7\": \"5:7\",\n                            \"2:3\": \"2:3 (4:6)\",\n                            \"16:9\": \"16:9\"\n                        },\n                        orientation: \"Orientation:\",\n                        portrait: \"Portrait\",\n                        landscape: \"Landscape\"\n                    },\n                    resize: {\n                        title: \"Resize image\",\n                        pixels: \"Pixels\",\n                        percents: \"Percents\"\n                    }\n                },\n                common: {\n                    width: \"Width:\",\n                    height: \"Height:\",\n                    cancel: \"Cancel\",\n                    confirm: \"Confirm\",\n                    lockAspectRatio: \"Lock aspect ratio\"\n                }\n            }\n        },\n\n        events: [\n            ERROR,\n            IMAGELOADED,\n            IMAGERENDERED,\n            EXECUTE\n        ],\n\n        defaultTools: {\n            open: { type: \"button\", icon: \"upload\", name: \"open\", command: \"OpenImageEditorCommand\", showText: \"overflow\" },\n            save: { type: \"button\", icon: \"download\", name: \"save\", command: \"SaveImageEditorCommand\", showText: \"overflow\", toggleCondition: \"canExport\" },\n            separator: { type: \"separator\" },\n            undo: { type: \"button\", icon: \"undo\", name: \"undo\", command: \"UndoImageEditorCommand\", showText: \"overflow\", toggleCondition: \"undo\" },\n            redo: { type: \"button\", icon: \"redo\", name: \"redo\", command: \"RedoImageEditorCommand\", showText: \"overflow\", toggleCondition: \"redo\" },\n            separator1: { type: \"separator\" },\n            crop: { type: \"button\", icon: \"crop\", name: \"crop\", command: \"OpenPaneImageEditorCommand\", options: \"crop\", showText: \"overflow\", toggleCondition: \"canExport\" },\n            resize: { type: \"button\", icon: \"image-resize\", name: \"resize\", command: \"OpenPaneImageEditorCommand\", options: \"resize\", showText: \"overflow\", toggleCondition: \"canExport\" },\n            zoomIn: { type: \"button\", icon: \"zoom-in\", name: \"zoomIn\", command: \"ZoomImageEditorCommand\", showText: \"overflow\", options: \"zoomIn\", toggleCondition: \"enable\" },\n            zoomOut: { type: \"button\", icon: \"zoom-out\", name: \"zoomOut\", command: \"ZoomImageEditorCommand\", showText: \"overflow\", options: \"zoomOut\", toggleCondition: \"enable\" },\n            zoomDropdown: {\n                type: \"component\",\n                name: \"zoomDropdown\",\n                command: \"ZoomImageEditorCommand\",\n                toggleCondition: \"enable\",\n                overflow: \"never\",\n                component: \"DropDownList\",\n                componentOptions: {\n                    placeholder: \"Search\",\n                    icon: \"search\",\n                    dataSource: [\n                        { name: \"zoomActualSize\", icon: \"zoom-actual-size\", value: \"actualSize\" },\n                        { name: \"zoomFitToScreen\", icon: \"zoom-best-fit\", value: \"fitToScreen\" }\n                    ],\n                    dataTextField: \"text\",\n                    dataValueField: \"value\",\n                    valuePrimitive: true,\n                    template: ({ icon, text }) => `${kendo.ui.icon(kendo.htmlEncode(icon))} ${kendo.htmlEncode(text)}`,\n                    commandOn: \"change\",\n                    optionLabel: \"Zoom options\",\n                    dataBound: (e) => {\n                        e.sender.list.find(\".k-list-optionlabel\").hide();\n                    }\n                }\n            }\n        },\n\n        _wrapper: function() {\n            var that = this,\n                options = that.options,\n                width = options.width,\n                height = options.height;\n\n            that.wrapper = that.element\n                .addClass(imageEditorStyles.wrapper);\n\n            if (width) {\n                that.wrapper.width(width);\n            }\n\n            if (height) {\n                that.wrapper.height(height);\n            }\n\n            that._resizeHandler = kendo.onResize(function() {\n                that.resize(true);\n            });\n        },\n\n        _renderHeader: function() {\n            var that = this,\n                options = that.options;\n\n            that.header = $(\"<div />\").addClass(imageEditorStyles.header);\n            that.wrapper.append(that.header);\n\n            if (options.toolbar) {\n                that._initToolbar();\n                that.toolbar._tabIndex();\n            }\n        },\n\n        _initToolbar: function() {\n            var that = this,\n                options = that.options,\n                toolbarElement = $(\"<div></div>\").addClass(imageEditorStyles.toolbar),\n                toolbarOptions = extend({}, options.toolbar),\n                tools = toolbarOptions.items ? toolbarOptions.items : Object.keys(that.defaultTools);\n\n            toolbarOptions.tools = tools;\n            toolbarOptions.defaultTools = that.defaultTools;\n            toolbarOptions.parentMessages = that.options.messages.toolbar;\n\n            that.header.append(toolbarElement);\n            that.toolbar = new kendo.ui.ToolBar(toolbarElement, toolbarOptions);\n            that.options.toolbar = that.toolbar.options;\n            that.toolbar.toggleTools();\n\n            that.toolbar.bind(CLICK, that._toolbarClick.bind(that));\n            that.toolbar.bind(TOGGLE, that._toolbarClick.bind(that));\n            that.toolbar.bind(CHANGE, that._toolbarClick.bind(that));\n\n            return that.toolbar;\n        },\n\n        _toolbarClick: function(ev) {\n            var command = $(ev.target).data(\"command\"),\n                options = $(ev.target).data(\"options\");\n\n            options = $(ev.target).val() || options;\n\n            if (!command) {\n                return;\n            }\n\n            this.executeCommand({\n                command: command,\n                options: options\n            });\n        },\n\n        _contentWrapper: function() {\n            var that = this,\n                contentWrapper = $(\"<div></div>\").addClass(imageEditorStyles.contentWrapper),\n                canvasWrapper = $(\"<div></div>\").addClass(imageEditorStyles.canvasWrapper),\n                canvasContainer = $(\"<div></div>\").addClass(imageEditorStyles.canvasContainer),\n                paneWrapper = $(\"<div></div>\").addClass(imageEditorStyles.paneWrapper).hide(),\n                toolbarHeight = outerHeight(that.header);\n\n            that.canvasWrapper = canvasWrapper;\n            that.canvasContainer = canvasContainer;\n            that.paneWrapper = paneWrapper;\n\n            canvasWrapper.append(canvasContainer);\n\n            contentWrapper.height(outerHeight(that.wrapper) - toolbarHeight);\n\n            contentWrapper.append(canvasWrapper).append(paneWrapper);\n            that.wrapper.append(contentWrapper);\n        },\n\n        _keyHandler: function() {\n            var that = this,\n                prevent = false;\n\n            that.wrapper.on(\"keydown\" + NS, function(ev) {\n                if (ev.ctrlKey) {\n                    switch (ev.keyCode) {\n                        case 48: // ctrl+0\n                            that.executeCommand({ command: \"ZoomImageEditorCommand\", options: \"fitToScreen\" });\n                            prevent = true;\n                            break;\n                        case 189: // ctrl+-\n                            that.executeCommand({ command: \"ZoomImageEditorCommand\", options: \"zoomOut\" });\n                            prevent = true;\n                            break;\n                        case 187: // ctrl++\n                            that.executeCommand({ command: \"ZoomImageEditorCommand\", options: \"zoomIn\" });\n                            prevent = true;\n                            break;\n                        case 90: // ctrl+z\n                            that.executeCommand({ command: \"UndoImageEditorCommand\" });\n                            prevent = true;\n                            break;\n                        case 89: // ctrl+y\n                            that.executeCommand({ command: \"RedoImageEditorCommand\" });\n                            prevent = true;\n                            break;\n                    }\n\n                    if (prevent) {\n                        ev.preventDefault();\n                    }\n                }\n            });\n        },\n\n        _drawCanvas: function() {\n            var that = this;\n            var imageUrl = that.options.imageUrl;\n\n            that.drawImage(imageUrl).done(function(image) {\n                if (!that.trigger(IMAGELOADED, { image: image })) {\n                    that.drawCanvas(image);\n                }\n            }).fail(function(ev) {\n                that.trigger(ERROR, ev);\n            });\n        },\n\n        _initUndoRedoStack: function() {\n            var that = this;\n\n            that.undoStack = [];\n            that.redoStack = [];\n        },\n\n        _toggleTools: function() {\n            var that = this,\n                canRedo = that.redoStack.length > 0,\n                canUndo = that.undoStack.length > 0,\n                hasImage = !!that._image,\n                canExport = true;\n\n            try {\n                that._canvas.toDataURL();\n            } catch (error) {\n                canExport = false;\n            }\n\n            if (that.toolbar) {\n                that.toolbar.toggleTools({\n                    redo: canRedo,\n                    undo: canUndo,\n                    enable: hasImage,\n                    canExport: canExport\n                });\n            }\n        },\n\n        drawImage: function(imageUrl) {\n            var that = this,\n                deferred = new $.Deferred(),\n                image = new Image();\n\n            image.onload = function() {\n                kendo.ui.progress(that.canvasContainer, false);\n                deferred.resolve(image);\n            };\n\n            image.onerror = function() {\n                kendo.ui.progress(that.canvasContainer, false);\n                deferred.reject(arguments);\n            };\n\n            kendo.ui.progress(that.canvasContainer, true);\n\n            image.src = imageUrl;\n\n            return deferred.promise();\n        },\n\n        drawCanvas: function(image) {\n            var that = this;\n            var canvas = $(kendo.template(CANVAS_TEMPLATE)(that.options.imageLabel))[0];\n            var ctx = canvas.getContext('2d');\n\n            if (that._canvas) {\n                $(that._canvas).remove();\n            }\n\n            if (that._image) {\n                that.undoStack.push(that._image);\n            }\n\n            that._canvas = canvas;\n            that._ctx = ctx;\n            that._image = image;\n\n            canvas.width = image.width;\n            canvas.height = image.height;\n\n            ctx.drawImage(image, 0, 0);\n\n            that.canvasContainer.append(canvas);\n\n            if (image.height > that.canvasWrapper.height()) {\n                that.executeCommand({ command: \"ZoomImageEditorCommand\", options: \"fitToScreen\" });\n            } else {\n                that.executeCommand({ command: \"ZoomImageEditorCommand\", options: that.getZoomLevel() });\n            }\n\n            that.trigger(IMAGERENDERED, {\n                canvas: canvas,\n                ctx: ctx,\n                image: image\n            });\n\n            that._toggleTools();\n        },\n\n        getCanvasElement: function() {\n            return this._canvas;\n        },\n\n        getCurrent2dContext: function() {\n            return this._ctx;\n        },\n\n        getCurrentImage: function() {\n            return this._image;\n        },\n\n        executeCommand: function(args) {\n            var commandName = args.command,\n                commandOptions = extend({ imageeditor: this }, isPlainObject(args.options) ? args.options : { value: args.options }),\n                command = new ui.imageeditor.commands[commandName](commandOptions);\n\n            if (!this.trigger(EXECUTE, args)) {\n                this._toggleTools();\n                return command.exec();\n            }\n        },\n\n        getZoomLevel: function() {\n            return this._zoomLevel || 1;\n        },\n\n        destroy: function() {\n            var that = this;\n\n            that.element.off(NS);\n\n            if (that.currentPaneTool) {\n                that.currentPaneTool.destroy();\n            }\n\n            if (that.toolbar) {\n                that.toolbar.destroy();\n            }\n\n            if (that._upload) {\n                that._upload.destroy();\n            }\n\n\n            Widget.fn.destroy.call(that);\n        }\n    });\n    ui.plugin(ImageEditor);\n})(window.kendo.jQuery);\nvar kendo$1 = kendo;\n\nexport { kendo$1 as default };\n"]}