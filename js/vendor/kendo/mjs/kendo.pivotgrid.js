/**
 * Kendo UI v2023.2.829 (http://www.telerik.com/kendo-ui)
 * Copyright 2023 Progress Software Corporation and/or one of its subsidiaries or affiliates. All rights reserved.
 *
 * Kendo UI commercial licenses may be obtained at
 * http://www.telerik.com/purchase/license-agreement/kendo-ui-complete
 * If you do not own a commercial license, this file shall be governed by the trial license terms.
 */
import"./kendo.pivot.common.js";import"./kendo.dom.js";import"./kendo.data.js";import"./kendo.icons.js";class Navigation{constructor(e){this.tabIndex=0,this.root=null,this.eventHandlers={},this.update=()=>{},this.tabIndex=e.tabIndex}get elements(){return this.root?Array.from(this.root.querySelectorAll(this.selectors.join(","))):[]}get first(){return this.root&&this.root.querySelector(this.selectors.join(","))||null}get last(){const e=this.elements;return e[e.length-1]||null}get current(){return this.elements.find((e=>e.matches(":focus")))}start(e){this.root=e;for(const t in this.mouseEvents)this.mouseEvents[t]&&(this.eventHandlers[t]=e=>{const r=e.target instanceof Element&&e.target.closest(this.selectors.join(","));r&&this.mouseEvents[t].call(void 0,r,this,e)},e.addEventListener(t,this.eventHandlers[t]));for(const t in this.keyboardEvents)this.keyboardEvents[t]&&(this.eventHandlers[t]=e=>{const r=e.target instanceof Element&&e.target.closest(this.selectors.join(",")),n=" "===e.key?"Space":e.key;r&&this.keyboardEvents[t][n]&&this.keyboardEvents[t][n].call(void 0,r,this,e)},e.addEventListener(t,this.eventHandlers[t]))}stop(){if(this.root)for(const e in this.eventHandlers)this.eventHandlers[e]&&this.root.removeEventListener(e,this.eventHandlers[e]);this.root=null}focusElement(e,t){e&&(t&&(t.removeAttribute("tabindex"),t.classList.remove("k-focus")),e.setAttribute("tabindex",String(this.tabIndex)),e.focus({preventScroll:!0}))}}const scrollableValuesSel=".k-pivotgrid .k-pivotgrid-values",scrollableColumnHeaderSel=".k-pivotgrid .k-pivotgrid-column-headers",scrollableRowHeaderSel=".k-pivotgrid .k-pivotgrid-row-headers",emptyCellSel=".k-pivotgrid > .k-pivotgrid-empty-cell",tableSel="table.k-pivotgrid-table",cellSel=".k-pivotgrid-cell",scrollables=[scrollableValuesSel,scrollableColumnHeaderSel,scrollableRowHeaderSel].join(","),selectors$1=[emptyCellSel,[scrollableColumnHeaderSel,tableSel,cellSel].join(" "),[scrollableRowHeaderSel,tableSel,cellSel].join(" "),[scrollableValuesSel,tableSel,cellSel].join(" ")],onEnter=(e,t,r)=>{const n=e.querySelector(".k-icon, .k-svg-icon");if(n){const s=t.elements.indexOf(e);t.update=()=>{t.focusElement(t.elements[s],null),t.update=()=>{}},n.click(),r.preventDefault()}},tryScrollLeft=(e,t,r)=>{e.offsetLeft<t.scrollLeft&&(r.scrollLeft=e.offsetLeft)},tryScrollRight=(e,t,r)=>{e.offsetLeft+e.offsetWidth>t.scrollLeft+t.offsetWidth&&e.offsetWidth<t.offsetWidth&&(r.scrollLeft=e.offsetLeft+e.offsetWidth-t.offsetWidth)},tryScrollUp=(e,t,r)=>{t.scrollTop&&e.offsetTop<t.scrollTop&&(r.scrollTop=e.offsetTop)},tryScrollDown=(e,t,r)=>{e.offsetTop+e.offsetHeight>t.scrollTop+t.offsetHeight&&e.offsetHeight<t.offsetHeight&&(r.scrollTop=e.offsetTop+e.offsetHeight-t.offsetHeight)},scrollTo=(e,t,r)=>{const n=t.querySelector(scrollableValuesSel),s=e&&e.closest(scrollables);n&&s&&e&&r.forEach((t=>t(e,s,n)))},tableMap=e=>{const t=Array.from(e.rows),r=Array.from(t&&t[0]&&t[0].cells||[]).map((e=>e.colSpan)).reduce(((e,t)=>e+t),0),n=t.map((()=>new Array(r)));return t.forEach(((e,t)=>{let r=0;Array.from(e.cells).forEach((e=>{for(let s=0;s<e.colSpan;s++){for(let s=0;s<e.rowSpan;s++){const i=n[t+s].findIndex(((e,t)=>t>=r&&!e));n[t+s][i]=e}r++}}))})),n},navigationMap=e=>{const t=tableMap(e.querySelector([scrollableColumnHeaderSel,tableSel].join(" "))),r=tableMap(e.querySelector([scrollableRowHeaderSel,tableSel].join(" "))),n=tableMap(e.querySelector([scrollableValuesSel,tableSel].join(" "))),s=e.querySelector(emptyCellSel),i=new Array(r[0].length).fill(s),a=[];for(let e=0;e<t.length;e++)a.push(i.concat(t[e]));for(let e=0;e<r.length;e++)a.push(r[e].concat(n[e]));return a},getTargetPos=(e,t)=>{for(let r=0;r<e.length;r++)for(let n=0;n<e[r].length;n++)if(e[r][n]===t)return[r,n];return[-1,-1]},ctrlKey=e=>e.ctrlKey||e.metaKey,cellAt=(e,t,r)=>{const n=navigationMap(e);let s=getTargetPos(n,t),i=[s[0]+r[0],s[1]+r[1]],a=n[i[0]]&&n[i[0]][i[1]];for(;a&&a===t;)i=[i[0]+r[0],i[1]+r[1]],a=n[i[0]]&&n[i[0]][i[1]];return a},keyboardEvents$1={keydown:{ArrowLeft:(e,t,r)=>{r.preventDefault();const n=cellAt(t.root,e,[0,-1]);t.focusElement(n,e),scrollTo(n,t.root,[tryScrollRight,tryScrollLeft,tryScrollDown,tryScrollUp])},ArrowRight:(e,t,r)=>{r.preventDefault();const n=cellAt(t.root,e,[0,1]);t.focusElement(n,e),scrollTo(n,t.root,[tryScrollLeft,tryScrollRight,tryScrollDown,tryScrollUp])},ArrowUp:(e,t,r)=>{r.preventDefault();const n=cellAt(t.root,e,[-1,0]);t.focusElement(n,e),scrollTo(n,t.root,[tryScrollRight,tryScrollLeft,tryScrollDown,tryScrollUp])},ArrowDown:(e,t,r)=>{r.preventDefault();const n=cellAt(t.root,e,[1,0]);t.focusElement(n,e),scrollTo(n,t.root,[tryScrollRight,tryScrollLeft,tryScrollUp,tryScrollDown])},o:(e,t,r)=>{if(!t.root)return;let n=t.root.nextElementSibling;n&&n instanceof HTMLElement&&(n.matches("div.k-pivotgrid-configurator-button")||(n=n.nextElementSibling),n&&n instanceof HTMLElement&&n.matches("div.k-pivotgrid-configurator-button")&&(t.root.parentNode&&!t.root.parentNode.querySelector(".k-pivotgrid-configurator.k-hidden")||n.click(),setTimeout((()=>{if(t.root.parentNode){const e=t.root.parentNode.querySelector(".k-pivotgrid-configurator-content .k-form-field .k-fields-list-wrapper .k-treeview");e instanceof HTMLElement&&(e.setAttribute("tabindex",String(t.tabIndex)),e.focus())}}),0)))},Enter:onEnter,Space:onEnter,Home:(e,t,r)=>{const n=navigationMap(t.root);let s=(ctrlKey(r)?n[0]:n.find((t=>Boolean(t.find((t=>t===e)))))||[])[0];s&&(t.focusElement(s,e),scrollTo(s,t.root,[tryScrollRight,tryScrollLeft,tryScrollDown,tryScrollUp]),r.preventDefault())},End:(e,t,r)=>{const n=navigationMap(t.root);let s=ctrlKey(r)?n[n.length-1]:n.find((t=>Boolean(t.find((t=>t===e)))))||[],i=s&&s[s.length-1]||null;i&&(t.focusElement(i,e),scrollTo(i,t.root,[tryScrollLeft,tryScrollRight,tryScrollUp,tryScrollDown]),r.preventDefault())}}},mouseEvents$1={click:(e,t)=>{if(e&&e instanceof HTMLElement){const r=t.elements.find((e=>e.hasAttribute("tabindex")))||null;t.focusElement(e,r)}}};class PivotGridNavigation extends Navigation{constructor(){super(...arguments),this.selectors=selectors$1,this.mouseEvents=mouseEvents$1,this.keyboardEvents=keyboardEvents$1}}const selectors=[".k-pivotgrid-configurator-content .k-form-field .k-fields-list-wrapper .k-treeview",".k-pivotgrid-configurator-content .k-chip",".k-pivotgrid-configurator-actions button"],onEscape=(e,t,r)=>{if(r.target instanceof HTMLElement&&t.root){const e=t.root.previousElementSibling,r=t.root.nextElementSibling,n=Array.from(e instanceof HTMLElement?e.querySelectorAll("[tabindex]"):[]).find((e=>e.tabIndex>=0));n instanceof HTMLElement&&(n.focus(),r instanceof HTMLElement&&r.click())}},navigate=(e,t,r,n)=>{r.preventDefault();const s=t.elements;let i=s.indexOf(e)+n;i<0&&(i=s.length-1),t.focusElement(s[i%s.length],e)},onDelete=(e,t,r)=>{if(r.target instanceof HTMLElement){r.target.querySelector(".k-icon.k-i-x-circle, .k-svg-icon.k-svg-i-x-circle")instanceof HTMLElement&&(r.preventDefault(),navigate(e,t,r,-1))}},keyboardEvents={keydown:{Tab:(e,t,r)=>{navigate(e,t,r,r.shiftKey?-1:1)},Escape:onEscape,Delete:onDelete,Backspace:onDelete}},mouseEvents={click:(e,t)=>{if(e&&e instanceof HTMLElement){const r=t.elements.find((e=>e.hasAttribute("tabindex")))||null;t.focusElement(e,r)}}};class ConfiguratorNavigation extends Navigation{constructor(){super(...arguments),this.selectors=selectors,this.mouseEvents=mouseEvents,this.keyboardEvents=keyboardEvents}}var __meta__={id:"pivotgrid",name:"PivotGrid",category:"web",description:"The PivotGrid widget is a data summarization tool.",depends:["dom","data","data.xml","sortable","pivot.common","icons"],features:[{id:"pivotgrid-configurator",name:"Configurator",description:"The PivotConfigurator widget allows the user to select data slices displayed in PivotGrid",depends:["pivot.configurator"]},{id:"pivotgrid-filtering",name:"Filtering",description:"Support for filtering",depends:["pivot.fieldmenu"]},{id:"pivotgrid-excel-export",name:"Excel export",description:"Export pivot grid data as Excel spreadsheet",depends:["ooxml"]},{id:"pivotgrid-pdf-export",name:"PDF export",description:"Export pivot grid data as PDF",depends:["pdf","drawing"]},{id:"mobile-scroller",name:"Mobile scroller",description:"Support for kinetic scrolling in mobile device",depends:["mobile.scroller"]}]};!function(e,t){var r=window.kendo,n=r.ui,s=r.htmlEncode,i=r.Class,a=r.data.Comparer,o=n.Widget,l=r.data.DataSource,c=r._outerWidth,u=r._outerHeight,h=window.kendo.pivotgrid.common,d=h.fetchDiscover,m=r.data.Query.normalizeFilter,p=r.data.Query.normalizeSort,f={}.toString,g=function(e){return e},v=e.map,_=e.extend,b=r.keys,x=r.isFunction,w=h.fetchData,S=h.createLocalDataState,y=h.createDataTree,k=h.sumAggregate,E=h.averageAggregate,N=h.minAggregate,A=h.maxAggregate,T=h.createDataState,M=h.toColumns,C=h.toRows,H=h.toTree,I=h.toData,D=h.headersReducer,R="resize",L="read",P="change",O="error",F="progress",B="Measures",U="stateReset",q="auto",W="<div></div>",$=".kendoPivotGrid",z="__row_total__",j="dataBinding",G="dataBound",V="expandMember",K=({id:t,key:n,headerClass:i,colspan:a,rowspan:o,expandable:l,iconClass:c,role:u,expanded:h})=>`<th id="${t}" role="${u}" ${l?`aria-expanded="${h}"`:""}  data-key="${s(n)}" class="k-table-th ${s(i)}" ${a?'colspan="'+s(a)+'"':""} ${o?'rowspan="'+s(o)+'"':""}>${l?r.ui.icon(e('<span role="presentation" class="k-pivotgrid-toggle"></span>'),{icon:`chevron-${s(c)}`}):""}</th>`,Y="collapseMember",Q="caret-alt-down",J="caret-alt-right",X=({member:e})=>`<span>${s(e.caption||e.name)}</span>`,Z={"kpi-trend-decrease":"caret-alt-down","kpi-trend-increase":"caret-alt-up","kpi-trend-equal":"minus"},ee=({dataItem:t})=>r.ui.icon(e(`<span title="${s(t.value)}"></span>`),{icon:"kpi-status-"+(t.value>0?"open":t.value<0?"deny":"hold")}),te=({dataItem:t})=>r.ui.icon(e(`<span title="${s(t.value)}"></span>`),{icon:Z["kpi-trend-"+(t.value>0?"increase":t.value<0?"decrease":"equal")]}),re=({dataItem:e})=>`${e&&s(e.fmtValue||e.value)||"&nbsp;"}`,ne="k-table-row",se="k-header k-table-th",ie="k-grid-header-table k-table k-table-md",ae="k-table k-table-md",oe="k-grid-table k-table k-table-md",le="k-table-tbody",ce="k-table-td";function ue(r){var n="string"==typeof r?[{name:r}]:r,s="[object Array]"===f.call(n)?n:n!==t?[n]:[];return v(s,(function(t){return"string"==typeof t?{name:t}:e.extend(!0,t,{name:t.name,type:t.type})}))}function he(e){var r="string"==typeof e?[{name:[e],expand:!1}]:e,n="[object Array]"===f.call(r)?r:r!==t?[r]:[];return v(n,(function(e){return"string"==typeof e?{name:[e],expand:!1}:{name:"[object Array]"===f.call(e.name)?e.name.slice():[e.name],expand:e.expand}}))}function de(e){return-1!==e.indexOf(" ")&&(e='["'+e+'"]'),e}function me(e,t,n,s){var i,a,o,l;if(n||(n=t),s||(s=0),(l=n.members[s])&&!l.measure){if(a=(o=l.children).length,n===t?e[r.stringify([l.name])]=!!a:a&&(e[r.stringify(xt(n,s))]=!0),a)for(i=0;i<a;i++)me(e,t,o[i],s);me(e,t,n,s+1)}}function pe(e){var t={};e.length&&me(t,e[0]);var r=[];for(var n in t)r.push({name:JSON.parse(n),expand:t[n]});return r}function fe(e,t,r){(function(e,t){var r=(t.tuples||[])[0];if(r&&e.length<r.members.length)for(var n=r.members,s=0;s<n.length;s++)if(!n[s].measure){for(var i=!1,a=0;a<e.length;a++)if(0===Ye(e[a]).indexOf(n[s].hierarchy)){i=!0;break}i||e.push({name:[n[s].name],expand:!1})}})(t,e=e||{}),r.length>1&&t.push({name:B,measure:!0,children:he(r)});var n={members:t};if(e.tuples){var s=Oe(e.tuples,n);s.tuple&&(t=function(e){for(var t=[],r=e.members,n=0;n<r.length;n++)r[n].measure||t.push({name:[r[n].name],expand:r[n].children.length>0});return t}(s.tuple))}return t}function ge(e){var t=r.getter(e.field,!0);return function(r,n){return e.aggregate(t(r.dataItem),n,r)}}function ve(e){return"number"==typeof e&&!isNaN(e)}function _e(e){return e&&e.getTime}function be(e){for(var t=[],r=0;r<e.length;r++)t.push({dir:e[r].dir,field:e[r].field.split(".").pop()});return t}function xe(e,t,n){var s={Sum:k,Average:E,Min:N,Max:A},i={value:function(e){return e[this.field]}.bind({field:e}),aggregate:s[t],caption:t,uniqueName:t,type:2,name:[t]};return n&&(i.aggregate.format=function(e){return r.format(this.format,e)}.bind({format:n})),i}var we={sum:function(e,t){var r=t.accumulator;return ve(r)?ve(e)&&(r+=e):r=e,r},count:function(e,t){return(t.accumulator||0)+1},average:{aggregate:function(e,r){var n=r.accumulator;return r.count===t&&(r.count=0),ve(n)?ve(e)&&(n+=e):n=e,ve(e)&&r.count++,n},result:function(e){var t=e.accumulator;return ve(t)&&(t/=e.count),t}},max:function(e,t){var r=t.accumulator;return ve(r)||_e(r)||(r=e),r<e&&(ve(e)||_e(e))&&(r=e),r},min:function(e,t){var r=t.accumulator;return ve(r)||_e(r)||(r=e),r>e&&(ve(e)||_e(e))&&(r=e),r}},Se=i.extend({init:function(e){this.options=_({},this.options,e),this.dimensions=this._normalizeDescriptors("field",this.options.dimensions),this.measures=this._normalizeDescriptors("name",this.options.measures)},_normalizeDescriptors:function(e,t){t=t||{};var r,n={};if("[object Array]"===f.call(t)){for(var s=0,i=t.length;s<i;s++)"string"==typeof(r=t[s])?n[r]={}:r[e]&&(n[r[e]]=r);t=n}return t},_rootTuples:function(e,r){var n,s,i,a,o=r.length||1,l=this.dimensions||[],c=0,u=e.length,h=[],d=[];if(u||r.length){for(c=0;c<o;c++){for(n={members:[]},a=0;a<u;a++)i=(s=e[a]).split("&"),n.members[n.members.length]={children:[],caption:(l[s]||{}).caption||"All",name:s,levelName:s,levelNum:"0",hasChildren:!0,parentName:i.length>1?i[0]:t,hierarchy:s};o>1&&(n.members[n.members.length]={children:[],caption:r[c].caption,name:r[c].descriptor.name,levelName:"MEASURES",levelNum:"0",hasChildren:!1,parentName:t,hierarchy:"MEASURES"}),h[h.length]=n}d.push(z)}return{keys:d,tuples:h}},_sortMap:function(t,r){var n,s,i,o=[],l=[];for(i in t)t[i].directParentName||l.push(e.extend({},{name:i,parentName:t[i].parentName}));if(!l.length)for(i in t)l.push(e.extend({},{name:i,parentName:t[i].parentName}));Te(l,t);for(var c=0;c<r.length;c++)Ae(r[c].field.split(".").pop(),l,a.create({field:"name",dir:r[c].dir}));n=Ne(l);for(var u=0;u<n.length;u++)(s=t[n[u].name]).index=u,o[u]=s;return o},_expandedTuples:function(r,n,s,i){var a,o,l,c,u,h,d,m,p,f,g,v=s.length||1,_=this.dimensions||[],b=[],x=[];for(l in i&&i.length&&!e.isEmptyObject(r)&&(r=this._sortMap(r,i)),r){for(c=r[l],u=b[(d=this._findExpandedMember(n,c.uniquePath)).index]||[],h=x[d.index]||[],m=d.member.names,a=0;a<v;a++){for(o={members:[]},g=0;g<m.length;g++)g===d.member.expandedIdx?(o.members[o.members.length]={children:[],caption:c.value,name:c.name,hasChildren:!1,levelNum:1,levelName:c.parentName+c.name,parentName:c.parentName,hierarchy:c.parentName+c.name},0===a&&h.push(xt(o,g).join(""))):(p=(f=m[g]).split("&"),o.members[o.members.length]={children:[],caption:(_[f]||{}).caption||"All",name:f,levelName:f,levelNum:"0",hasChildren:!0,parentName:p.length>1?p[0]:t,hierarchy:f});v>1&&(o.members[o.members.length]={children:[],caption:s[a].caption,name:s[a].descriptor.name,levelName:"MEASURES",levelNum:"0",hasChildren:!0,parentName:t,hierarchy:"MEASURES"}),u[u.length]=o}b[d.index]=u,x[d.index]=h}return{keys:x,tuples:b}},_findExpandedMember:function(e,t){for(var r=0;r<e.length;r++)if(e[r].uniquePath===t)return{member:e[r],index:r}},_asTuples:function(e,t,r,n){r=r||[];var s=this._rootTuples(t.root,r),i=this._expandedTuples(e,t.expanded,r,n);return{keys:[].concat.apply(s.keys,i.keys),tuples:[].concat.apply(s.tuples,i.tuples)}},_measuresInfo:function(e,t){for(var r,n,s=0,i=e&&e.length,a=[],o={},l={},c=this.measures||{};s<i;s++)r=c[n=e[s].descriptor.name]||{},a.push(n),r.result&&(o[n]=r.result),r.format&&(l[n]=r.format);return{names:a,formats:l,resultFuncs:o,rowAxis:t}},_toDataArray:function(e,t,r,n){var s,i,a,o,l,c,u,h,d,m,p=[],f=1,g=[],v=r.length||1,_=n.length||1;for(t.rowAxis?f=(g=t.names).length:m=t.names,a=0;a<v;a++)for(u=e[r[a]||z],c=0;c<f;c++)for(t.rowAxis&&(m=[g[c]]),o=0;o<_;o++)for(d=n[o]||z,h=u.items[d],s=d===z?u.aggregates:h?h.aggregates:{},l=0;l<m.length;l++)i=m[l],this._addData(p,s[i],t.formats[i],t.resultFuncs[i]);return p},_addData:function(e,t,n,s){var i,a="";t&&(t=s?s(t):t.accumulator,a=n?r.format(n,t):t),e[i=e.length]={ordinal:i,value:t||"",fmtValue:a}},_matchDescriptors:function(e,r,n){for(var s,i,a,o,l=r.names,c=r.expandedIdx;c>0;)if((s=l[--c].split("&")).length>1&&(i=s[0],a=s[1],(o=(o=n[i](e))!==t&&null!==o?o.toString():o)!=a))return!1;return!0},_calculateAggregate:function(e,t,r){for(var n,s,i={},a=0;a<e.length;a++)s=e[a].descriptor.name,(n=r.aggregates[s]||{}).accumulator=e[a].aggregator(t,n),i[s]=n;return i},_processColumns:function(e,r,n,s,i,a,o,l){for(var c,u,h,d,m,p,f,g,v=i.dataItem,_=0;_<r.length;_++)u=r[_],this._matchDescriptors(v,u,n)&&(g=u.names.slice(0,u.expandedIdx).join(""),f=p=u.names[u.expandedIdx],h=s[m=g+(p=p+"&"+(c=(c=n[p](v))!==t&&null!==c?c.toString():c))]||{index:o.columnIndex,parentName:f,name:p,directParentName:-1!==g.indexOf("&")?g:"",uniquePath:g+f,childrenMap:{},value:c},g&&s[g]&&!s[g].childrenMap[g+f+"&"+c]&&(s[g].childrenMap[g+f+"&"+c]=!0),d=a.items[m]||{aggregates:{}},a.items[m]={index:h.index,aggregates:this._calculateAggregate(e,i,d)},l&&(s[m]||o.columnIndex++,s[m]=h))},_measureAggregators:function(e){var t,r,n,s,i,a,o=e.measures||[],l=this.measures||{},c=[];if(o.length){for(n=0,s=o.length;n<s;n++)if(i=null,r=l[(t=o[n]).name]){if("string"==typeof(a=r.aggregate)){if(!(i=we[a.toLowerCase()]))throw new Error("There is no such aggregate function");r.aggregate=i.aggregate||i,r.result=i.result}c.push({descriptor:t,caption:r.caption,result:r.result,aggregator:ge(r)})}}else c.push({descriptor:{name:"default"},caption:"default",aggregator:function(){return 1}});return c},_buildGetters:function(e){for(var t,n,s={},i=0;i<e.length;i++)(t=(n=e[i]).split("&")).length>1?s[t[0]]=r.getter(t[0],!0):s[n]=r.getter(de(n),!0);return s},_parseDescriptors:function(e){for(var t=Xe(e),r=Qe(t.root),n=t.expanded,s=[],i=0;i<n.length;i++)s.push(Je(n[i].name,r));return{root:r,expanded:s}},_filter:function(e,t){if(!t)return e;for(var n,s=0,i=t.filters;s<i.length;s++)"in"===(n=i[s]).operator&&(i[s]=this._normalizeFilter(n));return new r.data.Query(e).filter(t).data},_normalizeFilter:function(e){var t=e.value.split(","),r=[];if(!t.length)return t;for(var n=0;n<t.length;n++)r.push({field:e.field,operator:"eq",value:t[n]});return{logic:"or",filters:r}},process:function(e,r){e=e||[],r=r||{},e=this._filter(e,r.filter);var n=r.measures||[],s="rows"===r.measuresAxis,i=r.columns||[],a=r.rows||[];!i.length&&a.length&&(!n.length||n.length&&s)&&(i=a,a=[],s=!1),i.length||a.length||(s=!1),!i.length&&n.length&&(i=he(r.measures)),i=this._parseDescriptors(i),a=this._parseDescriptors(a);var o,l,c,u,h,d,m,p,f,g,v,_,b,x={},w={},S={},y={columnIndex:0},k=this._measureAggregators(r),E=this._buildGetters(i.root),N=this._buildGetters(a.root),A=!1,T=i.expanded,M=a.expanded,C=0!==M.length,H=e.length,I=0;if(i.root.length||a.root.length)for(A=!0,I=0;I<H;I++)for(c={dataItem:l=e[I],index:I},m=x.__row_total__||{items:{},aggregates:{}},this._processColumns(k,T,E,w,c,m,y,!C),m.aggregates=this._calculateAggregate(k,c,m),x.__row_total__=m,u=0;u<M.length;u++)h=M[u],this._matchDescriptors(l,h,N)?(f=h.names.slice(0,h.expandedIdx).join(""),g=d=h.names[h.expandedIdx],S[p=f+(d=d+"&"+(o=(o=N[d](l))!==t?o.toString():o))]={uniquePath:f+g,parentName:g,name:d,value:o},v=x[p]||{items:{},aggregates:{}},this._processColumns(k,T,E,w,c,v,y,!0),v.aggregates=this._calculateAggregate(k,c,v),x[p]=v):this._processColumns(k,T,E,w,c,{items:{},aggregates:{}},y,!0);return A&&H?(!(k.length>1)||r.columns&&r.columns.length||(i={root:[],expanded:[]}),_=this._asTuples(w,i,s?[]:k,r.sort?r.sort:[]),b=this._asTuples(S,a,s?k:[],r.sort?r.sort:[]),w=_.tuples,S=b.tuples,x=this._toDataArray(x,this._measuresInfo(k,s),b.keys,_.keys)):x=w=S=[],{axes:{columns:{tuples:w},rows:{tuples:S}},data:x}}}),ye=i.extend({init:function(e,t){this.transport=t,this.options=t.options||{},this.transport.discover||x(e.discover)&&(this.discover=e.discover)},read:function(e){return this.transport.read(e)},update:function(e){return this.transport.update(e)},create:function(e){return this.transport.create(e)},destroy:function(e){return this.transport.destroy(e)},discover:function(e){if(this.transport.discover)return this.transport.discover(e);e.success({})},catalog:function(r){var n=this.options||{};if(r===t)return(n.connection||{}).catalog;var s=n.connection||{};s.catalog=r,this.options.connection=s,e.extend(this.transport.options,{connection:s})},cube:function(e){var r=this.options||{};if(e===t)return(r.connection||{}).cube;var n=r.connection||{};n.cube=e,this.options.connection=n,_(!0,this.transport.options,{connection:n})}}),ke=l.extend({init:function(t){var r=((t||{}).schema||{}).cube,n={axes:g,cubes:g,catalogs:g,measures:g,dimensions:g,hierarchies:g,levels:g,members:g};r&&(this.cubeSchema=e.extend(n,this._cubeSchema(r))),l.fn.init.call(this,_(!0,{},{},t));var s=this.options.transport||{};"xmla"===(this.options.type||"xmla").toLowerCase()&&(this._online=!0,this.transport=new at(s)),this._columns=he(this.options.columns),this._rows=he(this.options.rows);var i=this.cubeSchema?this.cubeSchema.measures():this.options.measures||[];"[object Object]"===f.call(i)&&(this._measuresAxis=i.axis||"columns",i=i.values||[]),this._measures=ue(i)},options:{serverSorting:!0,serverPaging:!0,serverFiltering:!0,serverGrouping:!0,serverAggregates:!0},axes:function(){return{columns:De(this.columns()),rows:De(this.rows())}},catalog:function(e){if(e===t)return this.transport.catalog();this.transport.catalog(e),this._mergeState({}),this.read()},cube:function(e){if(e===t)return this.transport.cube();this.transport.cube(e),this._mergeState({}),this.read()},measuresAxis:function(){return this._measuresAxis||"columns"},fetch:function(e){var r=this;if(this._data===t||0===this._data.length){return this._query().done((function(){x(e)&&e.call(r)}))}},_createSettings:function(e){for(var t,r=[],n=this.cubeSchema.dimensionsSettings(),s=function(e){return e[this.key]},i=function(e){return e},a=0;a<e.length;a++)t=e[a].name[0],r.push({key:t,displayValue:s.bind({key:t}),sortValue:i,caption:(n[t]||{}).caption||t});return r},_cubeSchema:function(e){return{dimensionsSettings:function(){return e.dimensions},dimensions:function(){var t=[],r=e.dimensions;for(var n in r)t.push({name:n,caption:r[n].caption||n,uniqueName:n,defaultHierarchy:n,type:1});return e.measures&&t.push({name:B,caption:B,uniqueName:B,type:2}),t},restoreMeasure:function(e,t){for(var r=0;r<e.length;r++)e[r].aggregate||(e[r].aggregate=t.aggregate,e[r].value=t.value,e[r].caption=t.caption,e[r].uniqueName=t.uniqueName,e[r].type=2)},measures:function(){var t=[],r=e.measures;for(var n in r)t.push(xe(r[n].field,n,r[n].format));return t},memberType:function(e){var t=r.getter(de(e),!0),n=this.options.data||this._pristineData||[];return n.length?typeof t(n[0]):null}.bind(this),members:function(t){var n,s,i=this.options.data||this._pristineData||[],a=[],o={},l=0;if(-1!==t.indexOf("[(ALL)]"))return[{caption:e.dimensions[t.split(".")[0]].caption||t,levelUniqueName:t,name:t,childrenCardinality:1,uniqueName:t}];for(n=r.getter(de(t),!0);l<i.length;l++)!(s=n(i[l]))&&0!==s&&!1!==s||o[s]||(o[s]=!0,a.push({caption:s+"",name:s+"",childrenCardinality:0,uniqueName:s}));return a}.bind(this)}},read:function(t){var r=this,n=r.trigger("requestStart",{type:L}),s=r._params(t),i=e.Deferred();if(!n)if(r.trigger(F),r.options.data){var a=(this.reader.data(this.options.data)||[]).slice(0);a&&!this._pristineData&&(this._pristineData=a);var o=r._createSettings(s.columnAxes),l=r._createSettings(s.rowAxes),c=r.measures(),u={dataTree:y(r.options.data,l,o,c,{dataField:"aggregate",columnsData:"columns"},r.filter()||[]),columnSettings:o,rowSettings:l,columnAxes:s.columnAxes,rowAxes:s.rowAxes,measures:c.map((function(e){return e})).reverse(),fields:{dataField:"aggregate",columnsData:"columns"},sort:be(s.sort||[])};r._saveState(S(u)),r.trigger(P),i.resolve()}else r.transport.read({data:s,success:function(e){r._saveState(e),r.trigger("requestEnd",{response:e,type:L}),r.trigger(P),r._preventRefresh&&(r._preventRefresh=!1),i.resolve()},error:function(e){r.trigger(O,{error:e})}});return i.promise()},_params:function(e){var t=this,r=l.fn._params.call(t,e);return r=_({columnAxes:JSON.parse(JSON.stringify(t._columns)),rowAxes:JSON.parse(JSON.stringify(t._rows)),measuresAxis:t.measuresAxis(),measureAxes:t._measures},r),"xmla"===(this.options.type||"").toLowerCase()&&(r.connection=t.options.transport.connection),r.filter&&(r.filter=m(r.filter),r.filter=(r.filter||{}).filters),r.sort&&(r.sort=p(r.sort)),r},discover:function(e){var t=this.transport;if(t.discover)return t.discover(e)},schemaMeasures:function(){var e=this;return e.discover({command:"schemaMeasures",restrictions:{catalogName:e.transport.catalog(),cubeName:e.transport.cube()}},(function(e){return e}))},schemaKPIs:function(){var e=this;return e.discover({command:"schemaKPIs",restrictions:{catalogName:e.transport.catalog(),cubeName:e.transport.cube()}},(function(e){return e}))},schemaDimensions:function(){var e=this;return e.discover({command:"schemaDimensions",restrictions:{catalogName:e.transport.catalog(),cubeName:e.transport.cube()}},(function(e){return e}))},schemaHierarchies:function(e){var t=this;return t.discover({command:"schemaHierarchies",restrictions:{catalogName:t.transport.catalog(),cubeName:t.transport.cube(),dimensionUniqueName:e}},(function(e){return e}))},schemaLevels:function(e){var t=this;return t.discover({command:"schemaLevels",restrictions:{catalogName:t.transport.catalog(),cubeName:t.transport.cube(),hierarchyUniqueName:e}},(function(e){return e}))},schemaCubes:function(){return this.discover({command:"schemaCubes",restrictions:{catalogName:this.transport.catalog()}},(function(e){return e}))},schemaCatalogs:function(){return this.discover({command:"schemaCatalogs"},(function(e){return e}))},schemaMembers:function(e){var t=this;return t.discover({command:"schemaMembers",restrictions:_({catalogName:t.transport.catalog(),cubeName:t.transport.cube()},e)},(function(e){return e}))},_saveState:function(e){var t=this;t._columnTuples=e.columns,t._rowTuples=e.rows,t._view=t._data=e.data},columns:function(e){if(e===t)return this._columns;this._columns=he(e),this.read()},rows:function(e){if(e===t)return this._rows;this._rows=he(e),this.read()},measures:function(e){if(e===t)return this._measures;this._measures=ue(e),this.read()},_mergeState:function(e){return e=l.fn._mergeState.call(this,e)},_query:function(e){var t=this,r=_({},{sort:t.sort(),measuresAxis:t.measuresAxis(),filter:t.filter()},e);return this._mergeState(r),this.read()}}),Ee=l.extend({init:function(t){var r,n=((t||{}).schema||{}).cube,s="columns",i={axes:g,cubes:g,catalogs:g,measures:g,dimensions:g,hierarchies:g,levels:g,members:g};n&&(i=e.extend(i,this._cubeSchema(n)),this.cubeBuilder=new Se(n)),l.fn.init.call(this,_(!0,{},{schema:i},t)),this.transport=new ye(this.options.transport||{},this.transport),this._columns=he(this.options.columns),this._rows=he(this.options.rows),r=this.options.measures||[],"[object Object]"===f.call(r)&&(s=r.axis||"columns",r=r.values||[]),this._measures=ue(r),this._measuresAxis=s,this._skipNormalize=0,this._axes={}},_cubeSchema:function(e){return{dimensions:function(){var t=[],r=e.dimensions;for(var n in r)t.push({name:n,caption:r[n].caption||n,uniqueName:n,defaultHierarchy:n,type:1});return e.measures&&t.push({name:B,caption:B,uniqueName:B,type:2}),t},hierarchies:function(){return[]},measures:function(){var t=[],r=e.measures;for(var n in r)t.push({name:n,caption:n,uniqueName:n,aggregator:n});return t},members:function(t,n){var s,i,a=n.levelUniqueName||n.memberUniqueName,o=this.options.schema.data,l=x(o)?o:r.getter(o,!0),c=this.options.data&&l(this.options.data)||this._rawData||[],u=[],h=0,d={};if(a&&(a=a.split(".")[0]),!n.treeOp)return u.push({caption:e.dimensions[a].caption||a,childrenCardinality:"1",dimensionUniqueName:a,hierarchyUniqueName:a,levelUniqueName:a,name:a,uniqueName:a}),u;for(s=r.getter(de(a),!0);h<c.length;h++)!(i=s(c[h]))&&0!==i||d[i]||(d[i]=!0,u.push({caption:i,childrenCardinality:"0",dimensionUniqueName:a,hierarchyUniqueName:a,levelUniqueName:a,name:i,uniqueName:i}));return u}.bind(this)}},options:{serverSorting:!0,serverPaging:!0,serverFiltering:!0,serverGrouping:!0,serverAggregates:!0},catalog:function(e){if(e===t)return this.transport.catalog();this.transport.catalog(e),this._mergeState({}),this._axes={},this.data([])},cube:function(e){if(e===t)return this.transport.cube();this.transport.cube(e),this._axes={},this._mergeState({}),this.data([])},axes:function(){return this._axes},columns:function(e){if(e===t)return this._columns;this._skipNormalize+=1,this._clearAxesData=!0,this._columns=he(e),this.query({columns:e,rows:this.rowsAxisDescriptors(),measures:this.measures(),sort:this.sort(),filter:this.filter()})},rows:function(e){if(e===t)return this._rows;this._skipNormalize+=1,this._clearAxesData=!0,this._rows=he(e),this.query({columns:this.columnsAxisDescriptors(),rows:e,measures:this.measures(),sort:this.sort(),filter:this.filter()})},measures:function(e){if(e===t)return this._measures;this._skipNormalize+=1,this._clearAxesData=!0,this.query({columns:this.columnsAxisDescriptors(),rows:this.rowsAxisDescriptors(),measures:ue(e),sort:this.sort(),filter:this.filter()})},measuresAxis:function(){return this._measuresAxis||"columns"},_expandPath:function(e,t){var r="columns"===t?"columns":"rows",n="columns"===t?"rows":"columns",s=he(e),i=Ye(s[s.length-1]);this._lastExpanded=r,s=fe(this.axes()[r],s,this.measures());for(var a=0;a<s.length;a++){if(Ye(s[a])===i){if(s[a].expand)return;s[a].expand=!0}else s[a].expand=!1}var o={};o[r]=s,o[n]=this._descriptorsForAxis(n),this._query(o)},_descriptorsForAxis:function(e){var t=this.axes(),r=this[e]()||[];return t&&t[e]&&t[e].tuples&&t[e].tuples[0]&&(r=pe(t[e].tuples||[])),r},columnsAxisDescriptors:function(){return this._descriptorsForAxis("columns")},rowsAxisDescriptors:function(){return this._descriptorsForAxis("rows")},_process:function(e,t){this._view=e,(t=t||{}).items=t.items||this._view,this.trigger(P,t)},_query:function(e){var t=this;return e||(this._skipNormalize+=1,this._clearAxesData=!0),t.query(_({},{page:t.page(),pageSize:t.pageSize(),sort:t.sort(),filter:t.filter(),group:t.group(),aggregate:t.aggregate(),columns:this.columnsAxisDescriptors(),rows:this.rowsAxisDescriptors(),measures:this.measures()},e))},query:function(t){var r=this._mergeState(t);return this._data.length&&this.cubeBuilder?(this._params(r),this._updateLocalData(this._pristineData),e.Deferred().resolve().promise()):this.read(r)},_mergeState:function(e){return(e=l.fn._mergeState.call(this,e))!==t&&(this._measures=ue(e.measures),e.columns?e.columns=he(e.columns):e.columns||(this._columns=[]),e.rows?e.rows=he(e.rows):e.rows||(this._rows=[])),e},filter:function(e){if(e===t)return this._filter;this._skipNormalize+=1,this._clearAxesData=!0,this._query({filter:e,page:1})},expandColumn:function(e){this._expandPath(e,"columns")},expandRow:function(e){this._expandPath(e,"rows")},success:function(e){var t;this.cubeBuilder&&(t=(this.reader.data(e)||[]).slice(0)),l.fn.success.call(this,e),t&&(this._pristineData=t)},_processResult:function(e,t){if(this.cubeBuilder){var r=this.cubeBuilder.process(e,this._requestData);e=r.data,t=r.axes}var n,s,i,a,o,l,c=this.columns(),u=this.rows(),h=t.columns&&t.columns.tuples;c.length||!u.length||!h||!this._rowMeasures().length&&this.measures().length||(t={columns:{},rows:t.columns}),c.length||u.length||"rows"!==this.measuresAxis()||!h||(t={columns:{},rows:t.columns}),this._axes={columns:De(this._axes.columns),rows:De(this._axes.rows)},t={columns:De(t.columns),rows:De(t.rows)},n=this._normalizeTuples(t.columns.tuples,this._axes.columns.tuples,c,this._columnMeasures()),s=this._normalizeTuples(t.rows.tuples,this._axes.rows.tuples,u,this._rowMeasures()),this._skipNormalize>0&&(this._skipNormalize-=1),this.cubeBuilder||(e=this._normalizeData({columnsLength:t.columns.tuples.length,rowsLength:t.rows.tuples.length,columnIndexes:n,rowIndexes:s,data:e})),"rows"==this._lastExpanded?(i=t.columns.tuples,o=this._columnMeasures(),(a=Ce(t.columns,this._axes.columns,o))&&(l="columns",t.columns=a,function(e,t,r,n,s){var i,a,o,l=e.length,c=Ie(t,n),u=n.length||1;for(a=0;a<r;a++)for(i=0;i<l;i++)o=He(e[i],t)*u,o+=i%u,s[a*l+i].ordinal=a*c+o}(i,a.tuples,t.rows.tuples.length,o,e),this.cubeBuilder||(e=this._normalizeData({columnsLength:Ie(t.columns.tuples,o),rowsLength:t.rows.tuples.length,data:e})))):"columns"==this._lastExpanded&&(i=t.rows.tuples,o=this._rowMeasures(),(a=Ce(t.rows,this._axes.rows,o))&&(l="rows",t.rows=a,function(e,t,r,n,s){var i,a,o,l=e.length,c=n.length||1;for(a=0;a<l;a++)for(o=He(e[a],t),o*=c,o+=a%c,i=0;i<r;i++)s[a*r+i].ordinal=o*r+i}(i,a.tuples,t.columns.tuples.length,o,e),this.cubeBuilder||(e=this._normalizeData({columnsLength:Ie(t.rows.tuples,o),rowsLength:t.columns.tuples.length,data:e})))),this._lastExpanded=null;var d=this._mergeAxes(t,e,l);return this._axes=d.axes,d.data},_readData:function(e){var t=this.reader.axes(e),r=this.reader.data(e);return this.cubeBuilder&&(this._rawData=r),this._processResult(r,t)},_createTuple:function(e,t,r){var n,s,i,a,o,l,c,u,h=e.members,d=h.length,m={members:[]},p=0;for(t&&(d-=1);p<d;p++)u=h[p],s=Number(u.levelNum),i=u.name,a=u.parentName,c=u.caption||i,o=u.hasChildren,l=u.hierarchy,n=u.levelName,r&&(c="All",0===s?a=u.name:s-=1,o=!0,i=l=n=a),m.members.push({name:i,children:[],caption:c,levelName:n,levelNum:s.toString(),hasChildren:o,hierarchy:l,parentName:r?"":a});return t&&m.members.push({name:t.name,children:[]}),m},_hasRoot:function(e,t,r){if(t.length)return Oe(t,e).tuple;for(var n,s,i,a=e.members,o=!0,l=0,c=a.length;l<c;l++)if(n=a[l],i=Number(n.levelNum)||0,s=r[l],!(0===i||s&&n.name===Ye(s))){o=!1;break}return o},_mergeAxes:function(e,t,r){var n,s,i=this._columnMeasures(),a=this._rowMeasures(),o=this.axes(),l=Ie(o.rows.tuples,a),c=e.rows.tuples.length,u=Ie(o.columns.tuples,i),h=e.columns.tuples.length;"columns"==r?(h=u,s=e.columns.tuples):t=function(e,t){if(!e||!e.length)return t;var r,n,s,i,a=[],o=We(e),l=o.length,c=Math.max(t.length/l,1);for(n=0;n<c;n++)for(s=l*n,r=0;r<l;r++)i=o[r]+s,a[s+r]=t[i]||{value:"",fmtValue:"",ordinal:i};return a}(s=qe(e.columns.tuples,i),t);var d=Le(o.columns.tuples,s,i);"rows"==r?(c=Ie(e.rows.tuples,a),s=e.rows.tuples):t=function(e,t){if(!e||!e.length)return t;var r,n,s,i,a,o=[],l=We(e),c=l.length,u=Math.max(t.length/c,1);for(r=0;r<c;r++)for(s=u*r,i=u*l[r],n=0;n<u;n++)a=parseInt(i+n,10),o[parseInt(s+n,10)]=t[a]||{value:"",fmtValue:"",ordinal:a};return o}(s=qe(e.rows.tuples,a),t);var m=Le(o.rows.tuples,s,a);if(o.columns.tuples=d.tuples,o.rows.tuples=m.tuples,u!==Ie(o.columns.tuples,i)){n=d.index+Re(d.parsedRoot,d.memberIndex,i);var p=u+h;t=this._mergeColumnData(t,n,c,h,p)}else l!==Ie(o.rows.tuples,a)&&(n=m.index+Re(m.parsedRoot,m.memberIndex,a),t=this._mergeRowData(t,n,c,h));return 0===o.columns.tuples.length&&0===o.rows.tuples.length&&(t=[]),{axes:o,data:t}},_mergeColumnData:function(e,t,r,n,s){var i,a,o,l=this.data().toJSON(),c=0,u=Math.max(this._columnMeasures().length,1);for(r=Math.max(r,1),l.length>0&&(c=u,s-=u),i=0;i<r;i++)a=t+i*s,(o=e.splice(0,n)).splice(0,c),[].splice.apply(l,[a,0].concat(o));return l},_mergeRowData:function(e,t,r,n){var s,i,a,o=this.data().toJSON(),l=Math.max(this._rowMeasures().length,1);for(n=Math.max(n,1),o.length>0&&(r-=l,e.splice(0,n*l)),s=0;s<r;s++)a=e.splice(0,n),i=t*n+s*n,[].splice.apply(o,[i,0].concat(a));return o},_columnMeasures:function(){var e=this.measures(),t=[];return"columns"===this.measuresAxis()&&(0===this.columns().length||e.length>1)&&(t=e),t},_rowMeasures:function(){var e=this.measures(),t=[];return"rows"===this.measuresAxis()&&(0===this.rows().length||e.length>1)&&(t=e),t},_updateLocalData:function(e,t){this.cubeBuilder&&(t&&(this._requestData=t),e=this._processResult(e)),this._data=this._observe(e),this._ranges=[],this._addRange(this._data),this._total=this._data.length,this._pristineTotal=this._total,this._process(this._data)},data:function(e){if(e===t)return this._data;this._pristineData=e.slice(0),this._updateLocalData(e,{columns:this.columns(),rows:this.rows(),measures:this.measures()})},_normalizeTuples:function(e,t,r,n){var s,i,a,o=n.length||1,l=0,c=[],u={},h=0;if(e.length){if(this._skipNormalize<=0&&!this._hasRoot(e[0],t,r)){for(this._skipNormalize=0;l<o;l++)c.push(this._createTuple(e[0],n[l],!0)),u[l]=l;e.splice.apply(e,[0,e.length].concat(c).concat(e)),l=o}if(n.length)for(a=s=e[l],i=s.members.length-1;s;){if(h>=o&&(h=0),s.members[i].name!==n[h].name&&(e.splice(l,0,this._createTuple(s,n[h])),u[l]=l),h+=1,s=e[l+=1],o>h&&(!s||wt(a,i-1)!==wt(s,i-1))){for(;h<o;h++)e.splice(l,0,this._createTuple(a,n[h])),u[l]=l,l+=1;s=e[l]}a=s}return u}},_addMissingDataItems:function(e,r){for(;r.rowIndexes[parseInt(e.length/r.columnsLength,10)]!==t;)for(var n=0;n<r.columnsLength;n++)e=Me(e);for(;r.columnIndexes[e.length%r.columnsLength]!==t;)e=Me(e);return e},_normalizeOrdinals:function(e,t,r){var n=r.lastOrdinal;if(!t)return Me(e);if(t.ordinal-n>1)for(n+=1;n<t.ordinal&&e.length<r.length;)e=this._addMissingDataItems(Me(e),r),n+=1;return t.ordinal=e.length,e[e.length]=t,e},_normalizeData:function(e){var t,r,n,s=e.data,i=0,a=[];if(e.lastOrdinal=0,e.columnIndexes=e.columnIndexes||{},e.rowIndexes=e.rowIndexes||{},e.columnsLength=e.columnsLength||1,e.rowsLength=e.rowsLength||1,e.length=e.columnsLength*e.rowsLength,n=e.length,s.length===n)return s;for(;a.length<n;)(t=s[i++])&&(r=t.ordinal),a=this._normalizeOrdinals(this._addMissingDataItems(a,e),t,e),e.lastOrdinal=r;return a},discover:function(t,r){var n=this,s=n.transport;return e.Deferred((function(e){s.discover(_({success:function(t){t=n.reader.parse(t),n._handleCustomErrors(t)||(r&&(t=r(t)),e.resolve(t))},error:function(t,r,s){e.reject(t),n.error(t,r,s)}},t))})).promise().done((function(){n.trigger("schemaChange")}))},schemaMeasures:function(){var e=this;return e.discover({data:{command:"schemaMeasures",restrictions:{catalogName:e.transport.catalog(),cubeName:e.transport.cube()}}},(function(t){return e.reader.measures(t)}))},schemaKPIs:function(){var e=this;return e.discover({data:{command:"schemaKPIs",restrictions:{catalogName:e.transport.catalog(),cubeName:e.transport.cube()}}},(function(t){return e.reader.kpis(t)}))},schemaDimensions:function(){var e=this;return e.discover({data:{command:"schemaDimensions",restrictions:{catalogName:e.transport.catalog(),cubeName:e.transport.cube()}}},(function(t){return e.reader.dimensions(t)}))},schemaHierarchies:function(e){var t=this;return t.discover({data:{command:"schemaHierarchies",restrictions:{catalogName:t.transport.catalog(),cubeName:t.transport.cube(),dimensionUniqueName:e}}},(function(e){return t.reader.hierarchies(e)}))},schemaLevels:function(e){var t=this;return t.discover({data:{command:"schemaLevels",restrictions:{catalogName:t.transport.catalog(),cubeName:t.transport.cube(),hierarchyUniqueName:e}}},(function(e){return t.reader.levels(e)}))},schemaCubes:function(){var e=this;return e.discover({data:{command:"schemaCubes",restrictions:{catalogName:e.transport.catalog()}}},(function(t){return e.reader.cubes(t)}))},schemaCatalogs:function(){var e=this;return e.discover({data:{command:"schemaCatalogs"}},(function(t){return e.reader.catalogs(t)}))},schemaMembers:function(e){var t=this,r=function(e){return function(r){return t.reader.members(r,e)}}(e);return t.discover({data:{command:"schemaMembers",restrictions:_({catalogName:t.transport.catalog(),cubeName:t.transport.cube()},e)}},r)},_params:function(e){this._clearAxesData&&(this._axes={},this._data=this._observe([]),this._clearAxesData=!1,this.trigger(U));var t=l.fn._params.call(this,e);return t=_({measures:this.measures(),measuresAxis:this.measuresAxis(),columns:this.columns(),rows:this.rows()},t),this.cubeBuilder&&(this._requestData=t),t}});function Ne(e){for(var t=[],r=0;r<e.length;r++)t.push(e[r]),e[r].children&&(t=t.concat(Ne(e[r].children)));return t}function Ae(e,t,r){for(var n=0;n<t.length;n++)t[n].children&&t[n].children.length&&Ae(e,t[n].children,r);t[0].parentName==e&&(t=t.sort(r))}function Te(t,r){for(var n=0;n<t.length;n++){var s=r[t[n].name];if(!e.isEmptyObject(s.childrenMap)){for(var i in t[n].children=[],s.childrenMap)t[n].children.push(e.extend({},{name:i,parentName:r[i].parentName}));Te(t[n].children,r)}}}function Me(e){return e[e.length]={value:"",fmtValue:"",ordinal:e.length},e}function Ce(e,t,r){if(e.tuples.length<Ie(t.tuples,r))return t}function He(e,t){return Oe(t,e).index}function Ie(e,t){if(!e.length)return 0;for(var r=e.slice(),n=r.shift(),s=1;n;)n.members?[].push.apply(r,n.members):n.children&&(n.measure||(s+=n.children.length),[].push.apply(r,n.children)),n=r.shift();return t.length&&(s*=t.length),s}function De(e){return e||(e={tuples:[]}),e.tuples||(e.tuples=[]),e}function Re(e,t,r){if(!e)return 0;for(var n=Math.max(r.length,1),s=e.members.slice(0,t),i=s.shift(),a=n;i;)i.name===B?a+=n-1:i.children?[].push.apply(s,i.children):(a++,[].push.apply(s,i.members)),i=s.shift();return a}function Le(e,t,r){if(!t[0])return{parsedRoot:null,tuples:e,memberIndex:0,index:0};var n=Oe(e,t[0]);if(!n.tuple)return{parsedRoot:null,tuples:t,memberIndex:0,index:0};var s=n.tuple.members,i=t[0].members,a=-1;if(s.length!==i.length)return{parsedRoot:null,tuples:t,memberIndex:0,index:0};for(var o=0,l=s.length;o<l;o++)!s[o].measure&&i[o].children[0]&&(-1==a&&i[o].children.length&&(a=o),s[o].children=i[o].children);return r=Math.max(r.length,1),{parsedRoot:n.tuple,index:n.index*r,memberIndex:a,tuples:e}}function Pe(e,t){var r,n,s=!0;for(e=e.members,t=t.members,r=0,n=e.length;r<n;r++)e[r].measure||t[r].measure||(s=s&&Ye(e[r])===Ye(t[r]));return s}function Oe(e,t){var r,n,s,i,a,o,l,c=0;for(r=0,n=e.length;r<n;r++){if(Pe(s=e[r],t))return{tuple:s,index:c};for(c++,a=0,o=s.members.length;a<o;a++)if(!(l=s.members[a]).measure&&(c+=(i=Oe(l.children,t)).index,i.tuple))return{tuple:i.tuple,index:c}}return{index:c}}function Fe(e,t){var r,n,s,i="";for(n=0,s=e.length;n<s;n++)t[i+=(r=e[n]).name]||(t[i]=r)}function Be(e,t){var r,n,s,i,a=e.members,o="",l="";for(r=0,n=a.length;r<n;r++){if(s=a[r],i){if(t[o+s.name]){i=t[o+=s.name];continue}return t[o+s.parentName]?t[o+s.parentName]:t[l+s.parentName]?t[l+s.parentName]:t[l]}if(o+=s.name,!(i=t[s.parentName])&&!(i=t[o]))return null;i&&(l+=i.name)}return i}function Ue(r,n){if(!(n<0)){var s={name:B,measure:!0,children:[e.extend({members:[],dataIndex:r.dataIndex},r.members[n])]};r.members.splice(n,1,s),r.dataIndex=t}}function qe(e,t){if(e.length<1)return[];for(var r=[],n={},s=function(e,t){if(0===t.length)return-1;for(var r=t[0],n=e.members,s=0,i=n.length;s<i;s++)if(n[s].name==r.name)return s}(e[0],t),i=0;i<e.length;i++){var a=e[i];a.dataIndex=i,Ue(a,s);var o=Be(a,n);o?s<0||!o.measure?o.children.push(a):o.children.push(a.members[s].children[0]):r.push(a),Fe(a.members,n)}return r}function We(e){for(var r,n,s,i,a,o=[],l=(e=e.slice()).shift();l;){for(l.dataIndex!==t&&o.push(l.dataIndex),s=0,r=0,n=l.members.length;r<n;r++)i=(a=l.members[r]).children,a.measure?[].splice.apply(e,[0,0].concat(i)):[].splice.apply(e,[s,0].concat(i)),s+=i.length;l=e.shift()}return o}function $e(e){var t=e.split(".");return t.length>2?t[0]+"."+t[1]:e}function ze(e,t){var r,n=e.length-1,s=e[n];return r=function(e,t){for(var r=0,n=e.length;r<n;r++)if(0===t.indexOf(e[r].field))return e[r];return null}(t,s),r&&r.dir?s="ORDER("+s+".Children,"+r.field+".CurrentMember.MEMBER_CAPTION,"+r.dir+")":s+=".Children",e[n]=s,e}function je(e){var t,r="CROSSJOIN({";return e.length>2?(t=e.pop(),r+=je(e)):(r+=e.shift(),t=e.pop()),r+="},{",r+=t,r+="})"}function Ge(e,t){var r=e.slice(0);return t.length>1&&r.push("{"+Ve(t).join(",")+"}"),je(r)}function Ve(e){for(var r,n=0,s=e.length,i=[];n<s;n++)r=e[n],i.push(r.name!==t?r.name:r);return i}function Ke(e,t){var r,n,s=-1;for(r=0,n=t.length;r<n;r++)if(Ye(t[r])===e){s=r;break}return s}function Ye(e){return e=e.name||e,"[object Array]"===f.call(e)&&(e=e[e.length-1]),e}function Qe(e){for(var t=e.length,r=[],n=0;n<t;n++)r.push(e[n].name[0]);return r}function Je(e,t){var r,n,s,i=0,a=e.length,o=t.length;for(t=t.slice(0);i<a;i++)for(r=e[i],s=0;s<o;s++)if(n=$e(t[s]),-1!==r.indexOf(n)){t[s]=r;break}return{names:t,expandedIdx:s,uniquePath:t.slice(0,s+1).join("")}}function Xe(e){for(var t,r,n,s,i,a,o=[],l=[],c=[],u=0,h=e.length;u<h;u++)if(s=(t=e[u]).name,a=!1,"[object Array]"!==f.call(s)&&(t.name=s=[s]),s.length>1)l.push(t);else{for(i=$e(s[0]),r=0,n=c.length;r<n;r++)if(0===c[r].name[0].indexOf(i)){a=!0;break}a||c.push(t),t.expand&&o.push(t)}return{root:c,expanded:o=o.concat(l)}}function Ze(e,t,r){var n,s="",i=Xe(e=e||[]),a=Qe(i.root),o=[],l=(i=i.expanded).length,c=0,u=[];if(a.length>1||t.length>1){for(o.push(Ge(a,t));c<l;c++)u=Je(n=ze(i[c].name,r),a).names,o.push(Ge(u,t));s+=o.join(",")}else{for(;c<l;c++)n=ze(i[c].name,r),u.push(n[0]);s+=a.concat(u).join(",")}return s}ke.create=function(e){var t=(e=e&&e.push?{data:e}:e)||{},n=t.data;if(t.data=n,!(t instanceof ke)&&t instanceof r.data.DataSource)throw new Error("Incorrect DataSource type. Only PivotDataSource instances are supported");return t instanceof ke?t:new ke(t)},Ee.create=function(e){var t=(e=e&&e.push?{data:e}:e)||{},n=t.data;if(t.data=n,!(t instanceof Ee)&&t instanceof r.data.DataSource)throw new Error("Incorrect DataSource type. Only PivotDataSource instances are supported");return t instanceof Ee?t:new Ee(t)};var et={contains:', InStr({0}.CurrentMember.MEMBER_CAPTION,"{1}") > 0',doesnotcontain:', InStr({0}.CurrentMember.MEMBER_CAPTION,"{1}")',startswith:', Left({0}.CurrentMember.MEMBER_CAPTION,Len("{1}"))="{1}"',endswith:', Right({0}.CurrentMember.MEMBER_CAPTION,Len("{1}"))="{1}"',eq:', {0}.CurrentMember.MEMBER_CAPTION = "{1}"',neq:', {0}.CurrentMember.MEMBER_CAPTION = "{1}"'};function tt(e){var t="",n=e.value,s=e.field,i=e.operator;return"in"==i?(t+="{",t+=n,t+="}"):(t+="neq"==i||"doesnotcontain"==i?"-":"",t+="Filter(",t+=s+".MEMBERS",t+=r.format(et[i],s,n),t+=")"),t}function rt(e,t,r){var n="";if(t){var s;for(var i in n+="<"+e+">",t)s=t[i],r&&(i=i.replace(/([A-Z]+(?=$|[A-Z][a-z])|[A-Z]?[a-z]+)/g,"$1_").toUpperCase().replace(/_$/,"")),n+="<"+i+">"+s+"</"+i+">";n+="</"+e+">"}else n+="<"+e+"/>";return n}var nt={schemaCubes:"MDSCHEMA_CUBES",schemaCatalogs:"DBSCHEMA_CATALOGS",schemaMeasures:"MDSCHEMA_MEASURES",schemaDimensions:"MDSCHEMA_DIMENSIONS",schemaHierarchies:"MDSCHEMA_HIERARCHIES",schemaLevels:"MDSCHEMA_LEVELS",schemaMembers:"MDSCHEMA_MEMBERS",schemaKPIs:"MDSCHEMA_KPIS"},st={read:function(e){var t='<Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/"><Header/><Body><Execute xmlns="urn:schemas-microsoft-com:xml-analysis"><Command><Statement>';t+="SELECT NON EMPTY {";var r=e.columns||[],n=e.rows||[],s=e.measures||[],i="rows"===e.measuresAxis,a=e.sort||[];return!r.length&&n.length&&(!s.length||s.length&&i)&&(r=n,n=[],i=!1),r.length||n.length||(i=!1),r.length?t+=Ze(r,i?[]:s,a):s.length&&!i&&(t+=Ve(s).join(",")),t+="} DIMENSION PROPERTIES CHILDREN_CARDINALITY, PARENT_UNIQUE_NAME ON COLUMNS",(n.length||i&&s.length>1)&&(t+=", NON EMPTY {",n.length?t+=Ze(n,i?s:[],a):t+=Ve(s).join(","),t+="} DIMENSION PROPERTIES CHILDREN_CARDINALITY, PARENT_UNIQUE_NAME ON ROWS"),e.filter?(t+=" FROM ",t+="(",t+=function(e,t){var r,n,s="",i=e.filters,a=i.length;for(n=a-1;n>=0;n--)r="SELECT (",r+=tt(i[n]),r+=") ON 0",s=n==a-1?r+=" FROM ["+t+"]":r+" FROM ( "+s+" )";return s}(e.filter,e.connection.cube),t+=")"):t+=" FROM ["+e.connection.cube+"]",1==s.length&&r.length&&(t+=" WHERE ("+Ve(s).join(",")+")"),(t+="</Statement></Command><Properties><PropertyList><Catalog>"+e.connection.catalog+"</Catalog><Format>Multidimensional</Format></PropertyList></Properties></Execute></Body></Envelope>").replace(/\&/g,"&amp;")},discover:function(t){var r='<Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/"><Header/><Body><Discover xmlns="urn:schemas-microsoft-com:xml-analysis">';return r+="<RequestType>"+(nt[(t=t||{}).command]||t.command)+"</RequestType>",r+="<Restrictions>"+rt("RestrictionList",t.restrictions,!0)+"</Restrictions>",t.connection&&t.connection.catalog&&(t.properties=e.extend({},{Catalog:t.connection.catalog},t.properties)),r+="<Properties>"+rt("PropertyList",t.properties)+"</Properties>",r+="</Discover></Body></Envelope>"}},it=r.data.RemoteTransport.extend({init:function(e){var t=e;e=this.options=_(!0,{},this.options,e),r.data.RemoteTransport.call(this,e),x(t.discover)?this.discover=t.discover:"string"==typeof t.discover?this.options.discover={url:t.discover}:t.discover||(this.options.discover=this.options.read)},setup:function(t,n){return t.data=t.data||{},e.extend(!0,t.data,{connection:this.options.connection}),r.data.RemoteTransport.fn.setup.call(this,t,n)},options:{read:{dataType:"text",contentType:"text/xml",type:"POST"},discover:{dataType:"text",contentType:"text/xml",type:"POST"},parameterMap:function(e,t){return st[t](e,t)}},discover:function(t){return e.ajax(this.setup(t,"discover"))}}),at=i.extend({init:function(e){e=this.options=_(!0,{},this.options,e)},setup:function(t){return e.extend(!0,t||{},{connection:this.options.connection})},read:function(t){var r,n,s=this,i=s.setup(t.data,L);r=t.success||e.noop,n=t.error||e.noop,t.parameterMap&&(i=s.parameterMap(i,L)),w({url:s.options.read},i).then(T).then((function(e){r(e)})).catch((function(e){n(e)}))},catalog:function(r){var n=this.options||{};if(r===t)return(n.connection||{}).catalog;var s=n.connection||{};s.catalog=r,this.options.connection=s,e.extend(this.transport.options,{connection:s})},cube:function(e){var r=this.options||{};if(e===t)return(r.connection||{}).cube;var n=r.connection||{};n.cube=e,this.options.connection=n,_(!0,this.transport.options,{connection:n})},discover:function(e){return d({url:this.options.read},e)}});function ot(e){return null==e?[]:"[object Array]"!==f.call(e)?[e]:e}function lt(e){for(var t={tuples:[]},n=ot(r.getter("Tuples.Tuple",!0)(e)),s=r.getter("Caption['#text']"),i=r.getter("UName['#text']"),a=r.getter("LName['#text']"),o=r.getter("LNum['#text']"),l=r.getter("CHILDREN_CARDINALITY['#text']",!0),c=r.getter("['@Hierarchy']"),u=r.getter("PARENT_UNIQUE_NAME['#text']",!0),h=0;h<n.length;h++){for(var d=[],m=ot(n[h].Member),p=0;p<m.length;p++)d.push({children:[],caption:s(m[p]),name:i(m[p]),levelName:a(m[p]),levelNum:o(m[p]),hasChildren:parseInt(l(m[p]),10)>0,parentName:u(m[p]),hierarchy:c(m[p])});t.tuples.push({members:d})}return t}var ct={cubes:{name:r.getter("CUBE_NAME['#text']",!0),caption:r.getter("CUBE_CAPTION['#text']",!0),description:r.getter("DESCRIPTION['#text']",!0),type:r.getter("CUBE_TYPE['#text']",!0)},catalogs:{name:r.getter("CATALOG_NAME['#text']",!0),description:r.getter("DESCRIPTION['#text']",!0)},measures:{name:r.getter("MEASURE_NAME['#text']",!0),caption:r.getter("MEASURE_CAPTION['#text']",!0),uniqueName:r.getter("MEASURE_UNIQUE_NAME['#text']",!0),description:r.getter("DESCRIPTION['#text']",!0),aggregator:r.getter("MEASURE_AGGREGATOR['#text']",!0),groupName:r.getter("MEASUREGROUP_NAME['#text']",!0),displayFolder:r.getter("MEASURE_DISPLAY_FOLDER['#text']",!0),defaultFormat:r.getter("DEFAULT_FORMAT_STRING['#text']",!0)},kpis:{name:r.getter("KPI_NAME['#text']",!0),caption:r.getter("KPI_CAPTION['#text']",!0),value:r.getter("KPI_VALUE['#text']",!0),goal:r.getter("KPI_GOAL['#text']",!0),status:r.getter("KPI_STATUS['#text']",!0),trend:r.getter("KPI_TREND['#text']",!0),statusGraphic:r.getter("KPI_STATUS_GRAPHIC['#text']",!0),trendGraphic:r.getter("KPI_TREND_GRAPHIC['#text']",!0),description:r.getter("KPI_DESCRIPTION['#text']",!0),groupName:r.getter("MEASUREGROUP_NAME['#text']",!0)},dimensions:{name:r.getter("DIMENSION_NAME['#text']",!0),caption:r.getter("DIMENSION_CAPTION['#text']",!0),description:r.getter("DESCRIPTION['#text']",!0),uniqueName:r.getter("DIMENSION_UNIQUE_NAME['#text']",!0),defaultHierarchy:r.getter("DEFAULT_HIERARCHY['#text']",!0),type:r.getter("DIMENSION_TYPE['#text']",!0)},hierarchies:{name:r.getter("HIERARCHY_NAME['#text']",!0),caption:r.getter("HIERARCHY_CAPTION['#text']",!0),description:r.getter("DESCRIPTION['#text']",!0),uniqueName:r.getter("HIERARCHY_UNIQUE_NAME['#text']",!0),dimensionUniqueName:r.getter("DIMENSION_UNIQUE_NAME['#text']",!0),displayFolder:r.getter("HIERARCHY_DISPLAY_FOLDER['#text']",!0),origin:r.getter("HIERARCHY_ORIGIN['#text']",!0),defaultMember:r.getter("DEFAULT_MEMBER['#text']",!0)},levels:{name:r.getter("LEVEL_NAME['#text']",!0),caption:r.getter("LEVEL_CAPTION['#text']",!0),description:r.getter("DESCRIPTION['#text']",!0),uniqueName:r.getter("LEVEL_UNIQUE_NAME['#text']",!0),dimensionUniqueName:r.getter("DIMENSION_UNIQUE_NAME['#text']",!0),displayFolder:r.getter("LEVEL_DISPLAY_FOLDER['#text']",!0),orderingProperty:r.getter("LEVEL_ORDERING_PROPERTY['#text']",!0),origin:r.getter("LEVEL_ORIGIN['#text']",!0),hierarchyUniqueName:r.getter("HIERARCHY_UNIQUE_NAME['#text']",!0)},members:{name:r.getter("MEMBER_NAME['#text']",!0),caption:r.getter("MEMBER_CAPTION['#text']",!0),uniqueName:r.getter("MEMBER_UNIQUE_NAME['#text']",!0),dimensionUniqueName:r.getter("DIMENSION_UNIQUE_NAME['#text']",!0),hierarchyUniqueName:r.getter("HIERARCHY_UNIQUE_NAME['#text']",!0),levelUniqueName:r.getter("LEVEL_UNIQUE_NAME['#text']",!0),childrenCardinality:r.getter("CHILDREN_CARDINALITY['#text']",!0)}},ut=["axes","catalogs","cubes","dimensions","hierarchies","levels","measures"],ht=r.data.XmlDataReader.extend({init:function(e){r.data.XmlDataReader.call(this,e),this._extend(e)},_extend:function(e){for(var t,r,n=0,s=ut.length;n<s;n++)(r=e[t=ut[n]])&&r!==g&&(this[t]=r)},parse:function(e){var t=r.data.XmlDataReader.fn.parse(e.replace(/<(\/?)(\w|-)+:/g,"<$1"));return r.getter("['Envelope']['Body']",!0)(t)},errors:function(e){var t=r.getter("['Fault']",!0)(e);return t?[{faultstring:r.getter("faultstring['#text']",!0)(t),faultcode:r.getter("faultcode['#text']",!0)(t)}]:null},axes:function(e){e=r.getter('ExecuteResponse["return"].root',!0)(e);for(var t,n=ot(r.getter("Axes.Axis",!0)(e)),s={columns:{},rows:{}},i=0;i<n.length;i++)"sliceraxis"!==(t=n[i])["@name"].toLowerCase()&&(s.columns.tuples?s.rows=lt(t):s.columns=lt(t));return s},data:function(e){e=r.getter('ExecuteResponse["return"].root',!0)(e);for(var t=ot(r.getter("CellData.Cell",!0)(e)),n=[],s=r.getter("['@CellOrdinal']"),i=r.getter("Value['#text']"),a=r.getter("FmtValue['#text']"),o=0;o<t.length;o++)n.push({value:i(t[o]),fmtValue:a(t[o]),ordinal:parseInt(s(t[o]),10)});return n},_mapSchema:function(e,t){e=r.getter('DiscoverResponse["return"].root',!0)(e);for(var n=ot(r.getter("row",!0)(e)),s=[],i=0;i<n.length;i++){var a={};for(var o in t)a[o]=t[o](n[i]);s.push(a)}return s},measures:function(e){return this._mapSchema(e,ct.measures)},kpis:function(e){return this._mapSchema(e,ct.kpis)},hierarchies:function(e){return this._mapSchema(e,ct.hierarchies)},levels:function(e){return this._mapSchema(e,ct.levels)},dimensions:function(e){return this._mapSchema(e,ct.dimensions)},cubes:function(e){return this._mapSchema(e,ct.cubes)},catalogs:function(e){return this._mapSchema(e,ct.catalogs)},members:function(e){return this._mapSchema(e,ct.members)}});_(!0,r.data,{PivotDataSource:Ee,PivotDataSourceV2:ke,XmlaTransport:it,XmlaDataReader:ht,PivotCubeBuilder:Se,transports:{xmla:it},readers:{xmla:ht}});var dt=function(e,t){for(var r=[],n=0,s=e.length;n<s;n++)e[n].field!==t&&r.push(e[n]);return r};r.ui.PivotSettingTarget=o.extend({init:function(t,s){var i=this;if(o.fn.init.call(i,t,s),i.element.addClass("k-pivot-setting"),i.dataSource=r.data.PivotDataSource.create(s.dataSource),i._refreshHandler=i.refresh.bind(i),i.dataSource.first(P,i._refreshHandler),!s.template){var a="";i.options.enabled&&(a=`<span class="k-setting-delete k-chip-action">${r.ui.icon("x")}</span>`),i.options.template=e=>`<span class="k-chip k-chip-md k-rounded-full k-chip-solid k-chip-solid-base" data-${r.ns}name="${e.name||e}"><span class="k-chip-content"><span class="k-chip-text">${e.name||e}</span></span><span class="k-chip-actions">`+a+"</span></span>"}i.template=r.template(i.options.template),i.emptyTemplate=r.template(i.options.emptyTemplate),i._sortable(),i.element.on("click"+$,".k-chip, .k-button",(function(t){var n=e(t.target).closest(":not(path,svg)"),s=n.closest(".k-chip-action"),a=n.closest("["+r.attr("name")+"]").attr(r.attr("name"));if(a)if(s.hasClass("k-setting-delete"))i.remove(a);else if(!(n.closest(".k-chip-actions").length>0)&&i.options.sortable){var o=e(t.currentTarget).closest(":not(path,svg)").find(".k-i-sort-asc-small,.k-svg-i-sort-asc-small").length?"desc":"asc";i.sort({field:a,dir:o})}})),(s.filterable||s.sortable)&&(i.fieldMenu=new n.PivotFieldMenu(i.element,{messages:i.options.messages.fieldMenu,filter:".k-setting-fieldmenu",filterable:s.filterable,sortable:s.sortable,dataSource:i.dataSource})),i.refresh()},options:{name:"PivotSettingTarget",template:null,filterable:!1,sortable:!1,emptyTemplate:e=>`<div class='k-empty'>${e}</div>`,setting:"columns",enabled:!0,messages:{empty:"Drop Fields Here"}},setDataSource:function(e){this.dataSource.unbind(P,this._refreshHandler),this.dataSource=this.options.dataSource=e,this.fieldMenu&&this.fieldMenu.setDataSource(e),e.first(P,this._refreshHandler),this.refresh()},_sortable:function(){var e=this;e.options.enabled&&(this.sortable=this.element.kendoSortable({connectWith:this.options.connectWith,hint:e.options.hint,filter:">*:not(.k-empty)",cursor:"move",start:function(e){e.item.trigger("focus").trigger("blur")},change:function(t){var n=t.item.attr(r.attr("name"));"receive"==t.action?e.add(n):"remove"==t.action?e.remove(n):"sort"==t.action&&e.move(n,t.newIndex)}}).data("kendoSortable"))},_isKPI:function(e){return"kpi"===e.type||e.measure},validate:function(e){var t=2==e.type||"aggregator"in e||this._isKPI(e);if(t)return"measures"===this.options.setting;if("measures"===this.options.setting)return t;var r=this.dataSource[this.options.setting](),n=e.defaultHierarchy||e.uniqueName;return!(Ke(n,r)>-1)&&!(Ke(n,r=this.dataSource["columns"===this.options.setting?"rows":"columns"]())>-1)},add:function(e){var t,r,n=this.dataSource[this.options.setting]();for(t=0,r=(e=Array.isArray(e)?e.slice(0):[e]).length;t<r;t++)-1!==Ke(e[t],n)&&(e.splice(t,1),t-=1,r-=1);e.length&&(n=n.concat(e),this.dataSource[this.options.setting](n))},move:function(e,t){var r=this.dataSource[this.options.setting](),n=Ke(e,r);n>-1&&(e=r.splice(n,1)[0],r.splice(t,0,e),this.dataSource[this.options.setting](r))},remove:function(e){var t=this.dataSource[this.options.setting](),r=Ke(e,t),n=this.dataSource.sort(),s=this.dataSource.filter();r>-1&&(s&&(s.filters=dt(s.filters,e),this.dataSource._filter.filters=s.filters,s.filters.length||(this.dataSource._filter=null)),n&&(n=dt(n,e),this.dataSource._sort=n),t.splice(r,1),this.dataSource[this.options.setting](t))},sort:function(e){var t=this.options.sortable,r=(!0===t||t.allowUnsort)&&"asc"===e.dir,n=this.dataSource.sort()||[],s=dt(n,e.field);r&&n.length!==s.length&&(e=null),e&&s.push(e),this.dataSource.sort(s)},refresh:function(){var e,r="",n=this.dataSource[this.options.setting](),s=n.length,i=0;if(s)for(;i<s;i++)e=(e=n[i]).name===t?{name:e}:e,r+=this.template(_({sortIcon:this._sortIcon(e.name)},e));else r=this.emptyTemplate(this.options.messages.empty);this.element.html(r)},destroy:function(){o.fn.destroy.call(this),this.dataSource.unbind(P,this._refreshHandler),this.element.off($),this.sortable&&this.sortable.destroy(),this.fieldMenu&&this.fieldMenu.destroy(),this.element=null,this._refreshHandler=null},_sortIcon:function(e){var t=function(e,t){if(!e)return null;for(var r=0,n=e.length;r<n;r++)if(e[r].field===t)return e[r];return null}(this.dataSource.sort(),Ye(e)),r="";return t&&(r="sort-"+t.dir),r}}),r.ui.PivotSettingTargetV2=o.extend({init:function(t,s){var i=this;o.fn.init.call(i,t,s),i.dataSource=r.data.PivotDataSourceV2.create(s.dataSource),i._refreshHandler=i.refresh.bind(i),i.dataSource.first(P,i._refreshHandler),i.template=r.template(i.options.template),i._sortable(),i.element.on("click"+$,".k-i-x-circle,.k-svg-i-x-circle",(function(t){var r=e(t.target).closest(":not(path,svg)").closest(".k-chip"),n=r.find(".k-chip-label").text();n&&(i.remove(n),r.remove(),i.trigger("remove",{name:n}))})),i.options.navigatable&&i.element.on("keydown"+$,".k-chip",(function(t){var r=e(t.target),n=t.keyCode,s=r.find(".k-chip-label").text();if(n===b.DELETE||n===b.BACKSPACE){const e=i.options.configuratorNavigation?i.options.configuratorNavigation.elements.indexOf(r[0]):-1;if(r.find(".k-i-x-circle,.k-svg-i-x-circle").trigger("click"),!i.options.configuratorNavigation)return;i.options.configuratorNavigation.focusElement(i.options.configuratorNavigation.elements[e-1])}else if(n===b.DOWN&&t.altKey)r.find(".k-i-more-vertical,.k-svg-i-more-vertical").trigger("click");else if(t.ctrlKey&&t.shiftKey)if(n==b.LEFT){if(i.move(s,Math.max(0,r.index()-1)),!i.options.configuratorNavigation)return;i.options.configuratorNavigation.focusElement(i.element.find(".k-chip .k-chip-label").filter(((t,r)=>e(r).text()==s)).closest(".k-chip")[0])}else if(n==b.RIGHT){if(i.move(s,Math.min(r.index()+1,r.parent().find("> .k-chip").length-1)),!i.options.configuratorNavigation)return;i.options.configuratorNavigation.focusElement(i.element.find(".k-chip .k-chip-label").filter(((t,r)=>e(r).text()==s)).closest(".k-chip")[0])}else if(n==b.UP&&"rows"==i.options.setting||n==b.DOWN&&"columns"==i.options.setting){let e=i.sortable.options.connectWith.data("kendoPivotSettingTargetV2");if(!e)return;if(i.remove(s),e.add(s),!i.options.configuratorNavigation)return;i.options.configuratorNavigation.focusElement(e.element.find(".k-chip").last()[0])}})),(s.filterable||s.sortable)&&(i.fieldMenu=new n.PivotFieldMenuV2(i.element,{messages:i.options.messages.fieldMenu,filterable:s.filterable,filter:".k-i-more-vertical,.k-svg-i-more-vertical",sortable:s.sortable,dataSource:i.dataSource})),i.refresh()},events:["remove"],options:{name:"PivotSettingTargetV2",template:null,filterable:!1,sortable:!1,setting:"columns",enabled:!0,messages:{empty:"Drop Fields Here"}},setDataSource:function(e){this.dataSource.unbind(P,this._refreshHandler),this.dataSource=this.options.dataSource=e,this.fieldMenu&&this.fieldMenu.setDataSource(e),e.first(P,this._refreshHandler),this.refresh()},_applyState:function(){this._sortState!==t&&(this.dataSource._sort=this._sortState,this._sortState=t),this._stateFilter!==t&&(this.dataSource._filter=this._stateFilter,this._stateFilter=t),this.dataSource["_"+this.options.setting]="measures"===this.options.setting?ue(this._savedState):he(this._savedState)},_cancelChanges:function(){this._sortState=t,this._stateFilter=t,this._savedState=r.deepExtend([],this._initialState),this._redraw()},_state:function(e,t){var n=this;if(!e)return n._savedState||[];n._savedState&&!t||(n._initialState=r.deepExtend([],e)),n._savedState=r.deepExtend([],e)},_sortable:function(){var e=this;this.sortable=this.element.kendoSortable({connectWith:this.options.connectWith,hint:e.options.hint,filter:">*:not(.k-empty)",cursor:"move",start:function(e){e.item.focus().blur()},change:function(t){var r=t.item.find(".k-chip-label").text();"receive"==t.action?e.add(r):"remove"==t.action?e.remove(r):"sort"==t.action&&e.move(r,t.newIndex)}}).data("kendoSortable")},add:function(e){var t,r,n=this._state();for(t=0,r=(e=Array.isArray(e)?e.slice(0):[e]).length;t<r;t++)-1!==Ke(e[t],n)&&(e.splice(t,1),t-=1,r-=1);e.length&&(n=n.concat(e),this._state(n),this._redraw())},move:function(e,t){var r=this._state(),n=Ke(e,r);n>-1&&(e=r.splice(n,1)[0],r.splice(t,0,e),this._state(r),this._redraw())},remove:function(e){var t=this._state(),r=Ke(e,t),n=this.dataSource.sort(),s=this.dataSource.filter();r>-1&&(s&&(s.filters=dt(s.filters,e),this._savedFilter=this.dataSource._filter,this._savedFilter.filters=s.filters,s.filters.length||(this._savedFilter=null)),n&&(n=dt(n,e),this._sortState=n),t.splice(r,1),this._state(t),this._redraw())},_emptyState:function(e){e?this.element.html(this.options.messages.empty).addClass("k-settings-description").removeClass("k-chip-list"):this.element.removeClass("k-settings-description").addClass("k-chip-list")},_redraw:function(){var e=this._state()||[];this._emptyState(!e.length),e.length&&this.element.html(this._targetsHTML(e))},_targetsHTML:function(e){var r,n="",s=0,i=this.options,a=!1;if("measures"!=this.options.setting&&(a=i.filterable||i.sortable),e.length)for(;s<e.length;s++)r=(r=e[s]).name===t?{name:r}:r,n+=this.template({name:r.name,menuenabled:a});return n},refresh:function(){if(!this.dataSource._preventRefresh){var e=this.dataSource[this.options.setting]();this._state(e,!0),this._emptyState(!this._state().length),e.length&&this.element.html(this._targetsHTML(e))}},destroy:function(){o.fn.destroy.call(this),this.dataSource.unbind(P,this._refreshHandler),this.element.off($),this.sortable&&this.sortable.destroy(),this.fieldMenu&&this.fieldMenu.destroy(),this.element=null,this._refreshHandler=null}});var mt=o.extend({init:function(t,r){var n=this;o.fn.init.call(n,t,r),n.element=e(t),n._element(),n._attachEvents()},options:{name:"PivotConfiguratorButton",text:"Change settings",configurator:""},destroy:function(){this.element.off($)},setOptions:function(e){r.deepExtend(this.options,e),this.init(this.element,this.options)},toggle:function(){var t,n=r.attr("role"),s=this.element.closest("["+n+"=pivotcontainer]").find("["+n+"=pivotgridv2]");e("#"+this.options.configurator).toggleClass("k-hidden"),s.length&&((t=s.getKendoPivotGridV2())._setContentWidth(),t._updateDimensions())},_attachEvents:function(){this.element.on("click"+$,this.toggle.bind(this))},_element:function(){var e=this.options;this.element.addClass("k-pivotgrid-configurator-button"),this.element.html(r.format("<span>{0}<span class='k-icon k-i-gear'></span></span>",e.text))}}),pt=o.extend({init:function(t,r){var n=this;o.fn.init.call(n,t,r),n.element=e(t),n.options=r,n._addClasses()},options:{name:"PivotContainer",configuratorPosition:"left"},setOptions:function(e){r.deepExtend(this.options,e),this.init(this.element,this.options)},_addClasses:function(){var e,t=this.options;switch(this.element.removeClass("k-flex-row k-flex-row-reverse k-flex-column k-flex-column-reverse"),t.configuratorPosition){case"right":default:e="k-flex-row";break;case"left":e="k-flex-row-reverse";break;case"bottom":e="k-flex-column";break;case"top":e="k-flex-column-reverse"}this.element.addClass("k-d-flex k-pos-relative").addClass(e)}}),ft=o.extend({init:function(t,n){var s=this;o.fn.init.call(s,t,n),s._dataSource(),s._bindConfigurator(),s._ariaId=s.element.attr("id")||r.guid(),s._wrapper(),s._columnHeadersWrapper=e('<div class="k-pivotgrid-column-headers"></div>'),s._rowHeadersWrapper=e('<div class="k-pivotgrid-row-headers"></div>'),s._contentWrapper=e('<div class="k-pivotgrid-values"></div>'),s.wrapper.append(s._columnHeadersWrapper),s.wrapper.append(s._rowHeadersWrapper),s.wrapper.append(s._contentWrapper),s._columnBuilder=new yt({template:this.options.columnHeaderTemplate,axes:"columns",ariaId:s._ariaId}),s._rowBuilder=new yt({template:this.options.rowHeaderTemplate,axes:"rows",ariaId:s._ariaId}),s._contentBuilder=new St({template:this.options.dataCellTemplate||re,ariaId:s._ariaId}),s._scrollable(),s._rowHeadersWrapper.add(s._columnHeadersWrapper).on("click","span.k-icon,span.k-svg-icon",(function(){var t=e(this),n=t.parent().attr(r.attr("key")),i=t.is(".k-i-chevron-up,.k-svg-i-chevron-up"),a=0!==t.closest(".k-pivotgrid-row-headers").length,o=n.split(","),l=i?Y:V;if(!s.trigger(l,{path:o,axis:a?"rows":"columns"})){var c={type:"HEADERS_ACTION_TOGGLE",payload:o,tree:a?s._rowBuilder.getTree():s._columnBuilder.getTree()},u=a?s.dataSource._rows:s.dataSource._columns,h=D(u,c);s.dataSource._preventRefresh=!0,a?s.dataSource.rows(h):s.dataSource.columns(h)}})),s.options.autoBind&&s.dataSource.fetch(),s._aria(),s.options.navigatable&&s._initPivotGridNavigation(),r.notify(s)},events:[j,G,V,Y],options:{name:"PivotGridV2",autoBind:!0,height:null,columnWidth:null,configurator:"",columnHeaderTemplate:null,rowHeaderTemplate:null,dataCellTemplate:null,messages:{emptyCellLabel:"PivotGrid Empty Cell"}},destroy:function(){var t=this;o.fn.destroy.call(t),t._windowResizeHandler&&(e(window).off(R+$,t._windowResizeHandler),t._windowResizeHandler=null)},_aria:function(){this.element.attr("role","grid")},_initPivotGridNavigation:function(){var e=this;e.navigation=new PivotGridNavigation({tabIndex:0}),e.navigation.start(e.element[0]);const t=e.navigation.first;t&&t.setAttribute("tabindex","0")},_matchAriaAttributes:function(e){var t=this;const r=e.querySelectorAll(".k-pivotgrid-row-headers .k-pivotgrid-row"),n=r[0]?Array.from(r[0].children).reduce(((e,t)=>e+(null!==t.getAttribute("colspan")?+t.getAttribute("colspan"):1)),0):[],s=e.querySelectorAll(".k-pivotgrid-column-headers tr"),i=e.querySelectorAll(".k-pivotgrid-column-headers th"),a=e.querySelectorAll(".k-pivotgrid-values td"),o=e.querySelector(".k-pivotgrid-empty-cell");o.setAttribute("aria-rowspan",s.length.toString()),o.setAttribute("aria-colspan",n.toString());const l=s[0],c=l?Array.from(l.children).map((e=>e.getAttribute("id"))).join(" "):[];l.setAttribute("aria-owns",`${o.getAttribute("id")} ${c}`),r.forEach(((e,r)=>{const n=t.filterAndMap(Array.from(a),(e=>{const t=e.getAttribute("id").split("-");return t[t.length-2]===(r+1).toString()}),(e=>e.getAttribute("id")));e.setAttribute("aria-owns",n.join(" "))})),a.forEach((e=>{const r=e.getAttribute("id").split("-"),n=+r[r.length-1],s=t.filterAndMap(Array.from(i),(e=>{const t=e.getAttribute("id").split("-"),r=+t[t.length-1],s=+e.getAttribute("colspan");return n===r||s>1&&r<n&&r+s-1>=n}),(e=>e.getAttribute("id")));e.setAttribute("aria-describedby",s.join(" "))}))},filterAndMap:function(e,t,r){return e.reduce(((e,n)=>t(n)?[...e,r(n)]:e),[])},_dataSource:function(){var e=this,t=e.options.dataSource;t=Array.isArray(t)?{data:t}:t,e.dataSource&&this._refreshHandler?e.dataSource.unbind(P,e._refreshHandler).unbind(F,e._progressHandler).unbind(O,e._errorHandler):(e._refreshHandler=e.refresh.bind(e),e._progressHandler=e._requestStart.bind(e),e._errorHandler=e._error.bind(e)),e.dataSource=r.data.PivotDataSourceV2.create(t).bind(P,e._refreshHandler).bind(F,e._progressHandler).bind(O,e._errorHandler)},_resize:function(){var e,t;this.wrapper[0].style.setProperty("--kendo-scrollbar-width",r.format("{0}px",(t=0,document&&document.createElement&&((e=document.createElement("div")).style.cssText="overflow:scroll;overflow-x:hidden;zoom:1;clear:both;display:block",e.innerHTML="&nbsp;",document.body.appendChild(e),t=e.offsetWidth-e.scrollWidth,document.body.removeChild(e)),t)))},_scrollable:function(){var t=this,n=t._columnHeadersWrapper,s=t._rowHeadersWrapper;t._resize(),t._windowResizeHandler=t._resize.bind(t),t._contentWrapper.scroll((function(){r.scrollLeft(n,this.scrollLeft),s.scrollTop(this.scrollTop)})),s.bind("DOMMouseScroll"+$+" mousewheel"+$,t._wheelScroll.bind(t)),e(window).on(R+$,t._windowResizeHandler)},_wheelScroll:function(t){if(!t.ctrlKey){var n=r.wheelDeltaY(t),s=this._contentWrapper.scrollTop();n&&(t.preventDefault(),e(t.currentTarget).one("wheel"+$,!1),this._rowHeadersWrapper.scrollTop(s+-n),this._contentWrapper.scrollTop(s+-n))}},_wrapper:function(){var t=this.options.height;this.wrapper=this.element.addClass("k-pivotgrid");var r=e(`<span class="k-pivotgrid-empty-cell" id="${this._ariaId}-empty-cell" role="columnheader"><span class="k-sr-only">${this.options.messages.emptyCellLabel}</span></span>`);this.wrapper.append(r),t&&this.wrapper.css("height",t)},_progress:function(e){r.ui.progress(this.wrapper,e)},_error:function(){this._progress(!1)},_requestStart:function(){this._progress(!0)},_updateDimensions:function(){var e=this;e.wrapper.css({"grid-template-columns":r.format("{0}px 1fr",e._rowHeadersWrapper.find(".k-pivotgrid-table")[0].offsetWidth),"grid-template-rows":r.format("{0}px 1fr",e._columnHeadersWrapper.find(".k-pivotgrid-table")[0].offsetHeight)})},_setContentWidth:function(){if(this.options.columnWidth){var e=this._contentWrapper.find("table"),t=this._columnHeadersWrapper.children("table"),r=this._rowHeadersWrapper.children("table");e.add(t).add(r).find("col").width(this.options.columnWidth)}},_bindConfigurator:function(){var t=this.options.configurator;t&&e(t).kendoPivotConfiguratorV2("setDataSource",this.dataSource)},cellInfoByElement:function(t){return t=e(t),this.cellInfo(t.index(),t.parent("tr").index())},cellInfo:function(e,t){var r,n,s=this._contentBuilder;return e>=s.columnsCount||e<0||t>=s.rowsCount||t<0?null:(r=t*s.columnsCount+e,{columnTuple:(n=s.hash[r<0?0:r]).columnTuple,rowTuple:n.rowTuple,dataItem:n.data})},refresh:function(){var e=this,t=e.dataSource;if(!e.trigger(j,{action:"rebind"})){var n=r._activeElement()?r._activeElement().id:null,s=e.wrapper.find("[tabindex=0]").attr("id");if(e._columnBuilder.setTuples(t._columnTuples),e._columnHeadersWrapper.html(e._columnBuilder.build()),e._rowBuilder.setTuples(t._rowTuples),e._rowHeadersWrapper.html(e._rowBuilder.build()),e._contentBuilder.setRowColumnInfo({columnHeaderLeafs:e._columnBuilder.getHeaderLeafs(),rowHeaderLeafs:e._rowBuilder.getHeaderLeafs(),columnHeaderBreadth:e._columnBuilder.getBreadth(),rowHeaderDepth:e._rowBuilder.getBreadth(),data:t._view}),e._contentWrapper.html(e._contentBuilder.build()),e._setContentWidth(),e._updateDimensions(),e._progress(!1),e.trigger(G),e._matchAriaAttributes(e.wrapper[0]),e.navigation){if(s&&e.element.find(`#${s}`).length>0)e.element.find(`#${s}`).attr("tabindex","0");else{const t=e.navigation.first;t&&t.setAttribute("tabindex","0")}n&&0==n.indexOf(e._ariaId)&&e.navigation.focusElement(e.element.find(`#${n}`)[0])}}}});n.plugin(mt),n.plugin(pt),n.plugin(ft);var gt=o.extend({init:function(n,s){var i,a,l=this;o.fn.init.call(l,n,s),J=r.support.isRtl(l.element)?"caret-alt-left":"caret-alt-right",l._dataSource(),l._bindConfigurator(),l._wrapper(),l._createLayout(),l._columnBuilder=i=new kt,l._rowBuilder=a=new Et,l._contentBuilder=new Nt,l._templates(),l.columnsHeader.add(l.rowsHeader).on("click","span.k-icon,span.k-svg-icon",(function(){var n,s=e(this),o=i,c="expandColumn",u=s.attr(r.attr("path")),h={axis:"columns",path:e.parseJSON(u)};s.parent().is("td")&&(o=a,c="expandRow",h.axis="rows");var d=s.is(".k-i-caret-alt-down,.k-svg-i-caret-alt-down"),m=o.metadata[u],p=m.expanded===t;n=d?Y:V,h.childrenLoaded=m.maxChildren>m.children,l.trigger(n,h)||(o.metadata[u].expanded=!d,r.ui.icon(s,{icon:d?J:Q}),!d&&p?l.dataSource[c](h.path):l.refresh())})),l._scrollable(),l.options.autoBind&&l.dataSource.fetch(),r.notify(l)},events:[j,G,V,Y],options:{name:"PivotGrid",autoBind:!0,reorderable:!0,filterable:!1,sortable:!1,navigatable:!1,height:null,columnWidth:100,configurator:"",columnHeaderTemplate:null,rowHeaderTemplate:null,dataCellTemplate:null,kpiStatusTemplate:null,kpiTrendTemplate:null,messages:{measureFields:"Drop Data Fields Here",columnFields:"Drop Column Fields Here",rowFields:"Drop Rows Fields Here"}},_templates:function(){var e=this.options.columnHeaderTemplate,t=this.options.rowHeaderTemplate,n=this.options.dataCellTemplate,s=this.options.kpiStatusTemplate,i=this.options.kpiTrendTemplate;this._columnBuilder.template=r.template(e||X,{useWithBlock:!!e}),this._contentBuilder.dataTemplate=r.template(n||re,{useWithBlock:!!n}),this._contentBuilder.kpiStatusTemplate=r.template(s||ee,{useWithBlock:!!s}),this._contentBuilder.kpiTrendTemplate=r.template(i||te,{useWithBlock:!!i}),this._rowBuilder.template=r.template(t||X,{useWithBlock:!!t})},_bindConfigurator:function(){var t=this.options.configurator;t&&e(t).kendoPivotConfigurator("setDataSource",this.dataSource)},cellInfoByElement:function(t){return t=e(t),this.cellInfo(t.index(),t.parent("tr").index())},cellInfo:function(e,t){var r,n=this._contentBuilder,s=n.columnIndexes[e||0],i=n.rowIndexes[t||0];return s&&i?(r=i.index*n.rowLength+s.index,{columnTuple:s.tuple,rowTuple:i.tuple,measure:s.measure||i.measure,dataItem:this.dataSource.view()[r]}):null},setDataSource:function(e){this.options.dataSource=e,this._dataSource(),this.measuresTarget&&this.measuresTarget.setDataSource(e),this.rowsTarget&&this.rowsTarget.setDataSource(e),this.columnsTarget&&this.columnsTarget.setDataSource(e),this._bindConfigurator(),this.options.autoBind&&e.fetch()},setOptions:function(e){o.fn.setOptions.call(this,e),this._templates()},destroy:function(){o.fn.destroy.call(this),clearTimeout(this._headerReflowTimeout)},_dataSource:function(){var e=this,t=e.options.dataSource;t=Array.isArray(t)?{data:t}:t,e.dataSource&&this._refreshHandler?e.dataSource.unbind(P,e._refreshHandler).unbind(U,e._stateResetHandler).unbind(F,e._progressHandler).unbind(O,e._errorHandler):(e._refreshHandler=e.refresh.bind(e),e._progressHandler=e._requestStart.bind(e),e._stateResetHandler=e._stateReset.bind(e),e._errorHandler=e._error.bind(e)),e.dataSource=r.data.PivotDataSource.create(t).bind(P,e._refreshHandler).bind(F,e._progressHandler).bind(U,e._stateResetHandler).bind(O,e._errorHandler)},_error:function(){this._progress(!1)},_requestStart:function(){this._progress(!0)},_stateReset:function(){this._columnBuilder.reset(),this._rowBuilder.reset()},_wrapper:function(){var e=this.options.height;this.wrapper=this.element.addClass("k-pivot"),e&&this.wrapper.css("height",e)},_measureFields:function(){this.measureFields=e(W).addClass("k-pivot-toolbar k-toolbar k-toolbar-md k-settings-measures"),this.measuresTarget=this._createSettingTarget(this.measureFields,{setting:"measures",messages:{empty:this.options.messages.measureFields}})},_createSettingTarget:function(t,n){var s,i=this.options;return s=({sortIcon:e,name:t})=>`<span class="k-chip k-chip-md k-rounded-full k-chip-solid k-chip-solid-base" tabindex="0" data-${r.ns}name="${t}"><span class="k-chip-content"><span class="k-chip-text">${t}</span></span><span class="k-chip-actions k-field-actions">`+function(e,t,n){var s=t.sortable,i=t.filterable,a=n.reorderable,o="";return s&&(o+=e?`<span class="k-chip-action">${r.ui.icon(e+"-sm")}</span>`:""),(i||s)&&(o+=`<span class="k-setting-fieldmenu k-chip-action">${r.ui.icon("more-vertical")}</span>`),a&&(o+=`<span class="k-setting-delete k-chip-action">${r.ui.icon("x")}</span>`),o}(e,n,i)+"</span></span>",new r.ui.PivotSettingTarget(t,e.extend({dataSource:this.dataSource,template:s,emptyTemplate:e=>`<span class="k-empty">${e}</span>`,enabled:this.options.reorderable},n))},_initSettingTargets:function(){this.columnsTarget=this._createSettingTarget(this.columnFields,{connectWith:this.rowFields,setting:"columns",filterable:this.options.filterable,sortable:this.options.sortable,messages:{empty:this.options.messages.columnFields,fieldMenu:this.options.messages.fieldMenu}}),this.rowsTarget=this._createSettingTarget(this.rowFields,{connectWith:this.columnFields,setting:"rows",filterable:this.options.filterable,sortable:this.options.sortable,messages:{empty:this.options.messages.rowFields,fieldMenu:this.options.messages.fieldMenu}})},_createLayout:function(){var t=this,n=e('<table class="k-pivot-layout"><tr><td><div class="k-pivot-rowheaders"></div></td><td><div class="k-pivot-table"></div></td></tr></table>'),s=n.find(".k-pivot-rowheaders"),i=n.find(".k-pivot-table"),a=e(W).addClass("k-grid");t._measureFields(),t.columnFields=e(W).addClass("k-pivot-toolbar k-toolbar k-toolbar-md k-settings-columns"),t.rowFields=e(W).addClass("k-pivot-toolbar k-toolbar k-toolbar-md k-settings-rows"),t.columnsHeader=e('<div class="k-grid-header-wrap" />').wrap('<div class="k-grid-header" />'),t.columnsHeader.parent().css("padding-right",r.support.scrollbar()),t.rowsHeader=e('<div class="k-grid k-alt"/>'),t.content=e('<div class="k-grid-content" />'),s.append(t.measureFields),s.append(t.rowFields),s.append(t.rowsHeader),a.append(t.columnsHeader.parent()),a.append(t.content),i.append(t.columnFields),i.append(a),t.wrapper.append(n),t.columnsHeaderTree=new r.dom.Tree(t.columnsHeader[0]),t.rowsHeaderTree=new r.dom.Tree(t.rowsHeader[0]),t.contentTree=new r.dom.Tree(t.content[0]),t._initSettingTargets()},_progress:function(e){r.ui.progress(this.wrapper,e)},_resize:function(){this.content[0].firstChild&&(this._setSectionsWidth(),this._setSectionsHeight(),this._setContentWidth(),this._setContentHeight(),this._columnHeaderReflow())},_columnHeaderReflow:function(){var e=this.columnsHeader.children("table");r.support.browser.mozilla&&(clearTimeout(this._headerReflowTimeout),e.css("table-layout","auto"),this._headerReflowTimeout=setTimeout((function(){e.css("table-layout","")})))},_setSectionsWidth:function(){var e,t=this.rowsHeader,r=t.parent(".k-pivot-rowheaders").width(q);e=Math.max(c(this.measureFields),c(this.rowFields)),e=Math.max(t.children("table").width(),e),r.width(e)},_setSectionsHeight:function(){var e=this.measureFields.height(q).height(),t=this.columnFields.height(q).height(),r=this.rowFields.height(q).innerHeight(),n=this.columnsHeader.height(q).innerHeight(),s=r-this.rowFields.height(),i=t>e?t:e,a=n>r?n:r;this.measureFields.height(i),this.columnFields.height(i),this.rowFields.height(a-s),this.columnsHeader.height(a)},_setContentWidth:function(){var e=this.content.find("table"),t=this.columnsHeader.children("table"),r=e.children("colgroup").children().length*this.options.columnWidth,n=Math.ceil(r/this.content.width()*100);n<100&&(n=100),e.add(t).css("width",n+"%"),this._resetColspan(t)},_setContentHeight:function(){var e=this,t=e.content,n=e.rowsHeader,s=e.wrapper.innerHeight(),i=r.support.scrollbar(),a=t[0].offsetHeight===t[0].clientHeight,o=e.options.height;if(e.wrapper.is(":visible")){if(!s||!o)return a&&(i=0),t.height("auto"),void n.height(t.height()-i);s-=u(e.columnFields),(s-=u(e.columnsHeader.parent()))<=2*i&&(s=2*i+1,a||(s+=i)),t.height(s),a&&(i=0),n.height(s-i)}},_resetColspan:function(e){var r=this,n=e.children("tbody").children().first().children().first();r._colspan===t&&(r._colspan=n.attr("colspan")),n.attr("colspan",1),clearTimeout(r._layoutTimeout),r._layoutTimeout=setTimeout((function(){n.attr("colspan",r._colspan),r._colspan=t}))},_axisMeasures:function(e){var t=[],r=this.dataSource,n=r.measures(),s=n.length>1||n[0]&&n[0].type;return r.measuresAxis()===e&&(0===r[e]().length||s)&&(t=n),t},items:function(){return[]},refresh:function(){var e,t,n=this,s=n.dataSource,i=s.axes(),a=(i.columns||{}).tuples||[],o=(i.rows||{}).tuples||[],l=n._columnBuilder,c=n._rowBuilder;if(!n.trigger(j,{action:"rebind"})){if(l.measures=n._axisMeasures("columns"),c.measures=n._axisMeasures("rows"),n.columnsHeaderTree.render(l.build(a)),n.rowsHeaderTree.render(c.build(o)),e={indexes:l._indexes,measures:l.measures,metadata:l.metadata},t={indexes:c._indexes,measures:c.measures,metadata:c.metadata},n.contentTree.render(n._contentBuilder.build(s.view(),e,t)),n._resize(),n.touchScroller)n.touchScroller.contentResized();else{var u=r.touchScroller(n.content);u&&u.movable&&(n.touchScroller=u,u.movable.bind("change",(function(e){r.scrollLeft(n.columnsHeader,-e.sender.x),n.rowsHeader.scrollTop(-e.sender.y)})))}n._progress(!1),n.trigger(G)}},_scrollable:function(){var e=this,t=e.columnsHeader,n=e.rowsHeader;e.content.on("scroll",(function(){r.scrollLeft(t,this.scrollLeft),n.scrollTop(this.scrollTop)})),n.on("DOMMouseScroll"+$+" mousewheel"+$,e._wheelScroll.bind(e))},_wheelScroll:function(t){if(!t.ctrlKey){var n=r.wheelDeltaY(t),s=this.content.scrollTop();n&&(t.preventDefault(),e(t.currentTarget).closest(":not(path,svg)").one("wheel"+$,!1),this.rowsHeader.scrollTop(s+-n),this.content.scrollTop(s+-n))}}}),vt=r.dom.element,_t=r.dom.html,bt=function(e,t){return{maxChildren:0,children:0,maxMembers:0,members:0,measures:1,levelNum:e,parentMember:0!==t}},xt=function(e,t){for(var r=[],n=0;n<=t;n++)r.push(e.members[n].name);return r},wt=function(e,t){for(var r="",n=0;n<=t;n++)r+=e.members[n].name;return r},St=i.extend({init:function(e){this.template=r.template(e.template),this.ariaId=e.ariaId,this.hash=[]},setRowColumnInfo:function(e){this.data=e.data,this.columnHeaderLeafs=e.columnHeaderLeafs,this.rowHeaderLeafs=e.rowHeaderLeafs,this.columnHeaderBreadth=e.columnHeaderBreadth,this.rowHeaderDepth=e.rowHeaderDepth,this.hash.length=0},addColElements:function(e){for(var t="",r=0;r<e;r++)t+="<col>";this.table.find("colgroup").append(t)},addRowElements:function(t){for(var r,n=this.table.find("tbody"),s=0;s<t.length;s++)r=e(`<tr class="${ne} k-pivotgrid-row" role='presentation'></tr>`),n.append(r),this.addColumCell(r,t[s],s);this.rowsCount=t.length},addColumCell:function(t,r,n){for(var s=0;s<r.cells.length;s++){var i=r.cells[s];if(i){var a=e(`<td id="${this.ariaId}-cell-${n+1}-${s+1}" class="${ce} k-pivotgrid-cell" role="gridcell"></td>`);(this.rowHeaderLeafs[n].total||this.columnHeaderLeafs[s].total)&&a.addClass("k-pivotgrid-header-total"),a.append(this.template({dataItem:i.data,rowTuple:i.rowTuple,columnTuple:i.columnTuple})),this.hash.push(i),t.append(a)}}},build:function(){var t=I((this.data||[]).slice(),this.columnHeaderLeafs,this.rowHeaderLeafs,this.columnHeaderBreadth,this.rowHeaderDepth),r=this,n=e(`<table class='${oe} k-pivotgrid-table' role='presentation'><colgroup></colgroup><tbody class='${le} k-pivotgrid-tbody' role='presentation'></tbody></table>`);return r.table=n,r.addColElements(this.columnHeaderLeafs.length),r.addRowElements(t),this.rowsCount=t.length,this.columnsCount=this.columnHeaderLeafs.length,r.table}}),yt=i.extend({init:function(e){this.tuples=e.tuples,this.axes=e.axes,this.ariaId=e.ariaId,this.headerTemplate=r.template(K),e.template&&(this.template=r.template(e.template))},setTuples:function(e){this.tuples=e},addColElements:function(e){for(var t="",r=0;r<e;r++)t+="<col>";this.table.find("colgroup").append(t)},addRowElements:function(t){for(var r,n=this.table.find("tbody"),s=0;s<t.length;s++)r=e('<tr class="k-table-row k-pivotgrid-row" role="row"></tr>'),n.append(r),this.addColumCell(r,t[s],s)},addColumCell:function(t,n,s){for(var i,a,o=this,l=0;l<n.cells.length;l++)(a=n.cells[l])&&((i=e(o.headerTemplate({id:`${o.ariaId}-${"columns"==o.axes?"ch":"rh"}-${s+1}-${l+1}`,rowspan:a.rowSpan,colspan:a.colSpan,key:a.path.join(",")+(a.total?"|[TOTAL]":""),iconClass:a.children&&a.children.length?"up":"down",expandable:a.hasChildren&&!a.total,expanded:a.children&&a.children.length?"true":"false",headerClass:r.format("k-pivotgrid-cell{0}{1}",a.total?" k-pivotgrid-header-total":"",0===a.levelNum?" k-pivotgrid-header-root":""),role:"columns"==o.axes?"columnheader":"rowheader"}))).append(o.template?o.template({member:a}):a.caption),t.append(i))},build:function(){var t=H((this.tuples||[]).slice()),r="columns"==this.axes?M(t):C(t),n=r[0],s=r[1],i=r[2],a=r[3],o=this;o._tree=t,o._breadth=i,o._headerLeafs=s;var l=e(`<table class='${ie} k-pivotgrid-table' role='presentation'><colgroup></colgroup><tbody class='${le} k-pivotgrid-tbody' role='rowgroup'></tbody></table>`);return o.table=l,o.addColElements("columns"==this.axes?s.length:a),o.addRowElements(n),o.table},getTree:function(){return this._tree},getBreadth:function(){return this._breadth},getHeaderLeafs:function(){return this._headerLeafs}}),kt=i.extend({init:function(){this.measures=1,this.metadata={}},build:function(e){var t=this._tbody(e),r=this._colGroup();return[vt("table",{className:ie},[r,t])]},reset:function(){this.metadata={}},_colGroup:function(){for(var e=this._rowLength(),t=[],r=0;r<e;r++)t.push(vt("col",null));return vt("colgroup",null,t)},_tbody:function(e){var t=e[0];return this.map={},this.rows=[],this.rootTuple=t,this._indexes=[],t?(this._buildRows(t,0),this._normalize()):this.rows.push(vt("tr",{className:ne},[vt("th",{className:se},[_t("&nbsp;")])])),vt("tbody",{className:le},this.rows)},_normalize:function(){for(var e,t,r,n,s,i=this.rows,a=i.length,o=0;o<a;o++)if(1!==(e=i[o]).rowSpan)for(r=0,t=(n=e.children).length;r<t;r++)(s=n[r]).tupleAll&&(s.attr.rowSpan=e.rowSpan)},_rowIndex:function(e){for(var t=this.rows,r=t.length,n=0;n<r&&t[n]!==e;n++);return n},_rowLength:function(){var e=this.rows[0]?this.rows[0].children:[],t=e.length,r=0,n=0;if(t)for(;n<t;n++)r+=e[n].attr.colSpan||1;return r||(r=this.measures),r},_row:function(e,t,r){var n,s,i=this.rootTuple.members[t].name,a=e.members[t].levelNum,o=i+a,l=this.map,c=l[o];return c?(c.notFirst=!1,c.parentMember&&c.parentMember===r||(c.parentMember=r,c.collapsed=0,c.colSpan=0)):((c=vt("tr",{className:ne},[])).parentMember=r,c.collapsed=0,c.colSpan=0,c.rowSpan=1,l[o]=c,(n=l[i+(Number(a)-1)])&&((s=n.children)[1]&&-1===s[1].attr.className.indexOf("k-alt")?c.notFirst=!0:c.notFirst=n.notFirst),this.rows.splice(this._rowIndex(n)+1,0,c)),c},_measures:function(e,t,r){var n,s=this.map,i=s.measureRow;i||(i=vt("tr",{className:ne},[]),s.measureRow=i,this.rows.push(i));for(var a=0,o=e.length;a<o;a++)n=e[a],i.children.push(this._cell(r||"",[this._content(n,t)],n));return o},_content:function(e,t){return _t(this.template({member:e,tuple:t}),!0)},_cell:function(e,t,r){var n=vt("th",{className:se+" "+e},t);return n.value=r.caption||r.name,n},_buildRows:function(t,n,s){var i,a,o,l,c,u,h,d,m,p=t.members,f=p[n],g=p[n+1],v=[],_=0,b=0,x=0;if(!f.measure){if(h=r.stringify(xt(t,n)),i=this._row(t,n,s),l=(o=f.children).length,(d=this.metadata[h])||(this.metadata[h]=d=bt(Number(f.levelNum),n),d.rootLevelNum=Number(this.rootTuple.members[n].levelNum)),this._indexes.push({path:h,tuple:t}),f.hasChildren){!1===d.expanded&&(b=d.maxChildren,i.collapsed+=b,d.children=0,l=0);let t=e("<span></span>");t.attr(r.attr("path"),h),v.push(r.dom.html(r.ui.icon(t,{icon:l?Q:J})))}if(v.push(this._content(f,t)),c=this._cell(i.notFirst?" k-first":"",v,f),i.children.push(c),i.colSpan+=1,l){for(u=this._cell(" k-alt",[this._content(f,t)],f),i.children.push(u);_<l;_++)a=this._buildRows(o[_],n,f);m=a.colSpan,b=a.collapsed,c.attr.colSpan=m,d.children=m,d.members=1,i.colSpan+=m,i.collapsed+=b,i.rowSpan=a.rowSpan+1,g&&(g.measure?m=this._measures(g.children,t," k-alt"):(m=(a=this._buildRows(t,n+1)).colSpan,i.collapsed+=a.collapsed,x=a.collapsed),u.attr.colSpan=m,m-=1,d.members+=m,i.colSpan+=m)}else g&&(g.measure?m=this._measures(g.children,t):(m=(a=this._buildRows(t,n+1)).colSpan,i.collapsed+=a.collapsed,x=a.collapsed),d.members=m,m>1&&(c.attr.colSpan=m,i.colSpan+=m-1));return d.maxMembers<d.members+x&&(d.maxMembers=d.members+x),o=d.children+b,d.maxChildren<o&&(d.maxChildren=o),(u||c).tupleAll=!0,i}this._measures(f.children,t)}}),Et=i.extend({init:function(){this.metadata={}},build:function(e){var t=this._tbody(e),r=this._colGroup();return[vt("table",{className:ae},[r,t])]},reset:function(){this.metadata={}},_rowLength:function(){for(var e=this.rows[0].children,t=0,r=0,n=e[r];n;)t+=n.attr.colSpan||1,n=e[++r];return t},_colGroup:function(){for(var e=this._rowLength(),t=[],r=0;r<e;r++)t.push(vt("col",null));return vt("colgroup",null,t)},_tbody:function(e){var t=e[0];return this.rootTuple=t,this.rows=[],this.map={},this._indexes=[],t?(this._buildRows(t,0),this._normalize()):this.rows.push(vt("tr",{className:ne},[vt("td",{className:ce},[_t("&nbsp;")])])),vt("tbody",{className:le},this.rows)},_normalize:function(){for(var e,t,r,n,s=this.rows,i=s.length,a=0,o=this.rootTuple.members,l=o[0].name,c=o.length,u=0,h=this.map;a<i;a++)for(e=s[a],u=0;u<c;u++)r=this[o[u].name],(t=e.colSpan["dim"+u])&&t.colSpan<r&&(t.attr.colSpan=r-t.colSpan+1);e=h[l],n=h[l+"all"],e&&(e.children[0].attr.className=ce+" k-first"),n&&(n.children[0].attr.className+=" k-first "+ce)},_row:function(e){var t=vt("tr",{className:ne},e);return t.rowSpan=1,t.colSpan={},this.rows.push(t),t},_content:function(e,t){return _t(this.template({member:e,tuple:t}),!0)},_cell:function(e,t,r){var n=vt("td",{className:ce+" "+e},t);return n.value=r.caption||r.name,n},_buildRows:function(t,n){var s,i,a,o,l,c,u,h,d=this.map,m=t.members,p=m[n],f=m[n+1],g=p.children,v=g.length,_=Number(p.levelNum),b=this.rootTuple.members[n].name,x=xt(t,n-1).join(""),w=Number(this.rootTuple.members[n].levelNum),S=x+(w===_?"":p.parentName||""),y=d[S+"all"]||d[S],k=_+1,E=[];if(!y||y.hasChild?y=this._row():y.hasChild=!0,p.measure){for(u=y.allCell?"k-grid-footer":"",y.children.push(this._cell(u,[this._content(g[0],t)],g[0])),y.rowSpan=v,h=1;h<v;h++)this._row([this._cell(u,[this._content(g[h],t)],g[h])]);return y}if(d[x+p.name]=y,s=r.stringify(xt(t,n)),(c=this.metadata[s])||(this.metadata[s]=c=bt(_,n),c.rootLevelNum=w),this._indexes.push({path:s,tuple:t}),p.hasChildren){!1===c.expanded&&(v=0,c.children=0);let t=e("<span></span>");t.attr(r.attr("path"),s),E.push(r.dom.html(r.ui.icon(t,{icon:v?Q:J})))}if(E.push(this._content(p,t)),u=y.allCell&&!v?"k-grid-footer":"",(i=this._cell(u,E,p)).colSpan=k,y.children.push(i),y.colSpan["dim"+n]=i,(!this[b]||this[b]<k)&&(this[b]=k),v){for(y.allCell=!1,y.hasChild=!1,h=0;h<v;h++)y!==(o=this._buildRows(g[h],n))&&(y.rowSpan+=o.rowSpan);y.rowSpan>1&&(i.attr.rowSpan=y.rowSpan),c.children=y.rowSpan,(a=this._cell("k-grid-footer",[this._content(p,t)],p)).colSpan=k,(l=this._row([a])).colSpan["dim"+n]=a,l.allCell=!0,d[x+p.name+"all"]=l,f&&(o=this._buildRows(t,n+1),a.attr.rowSpan=o.rowSpan),y.rowSpan+=l.rowSpan,c.members=l.rowSpan}else f&&(y.hasChild=!1,this._buildRows(t,n+1),(a||i).attr.rowSpan=y.rowSpan,c.members=y.rowSpan);return c.maxChildren<c.children&&(c.maxChildren=c.children),c.maxMembers<c.members&&(c.maxMembers=c.members),y}}),Nt=i.extend({init:function(){this.columnAxis={},this.rowAxis={}},build:function(e,r,n){var s=r.indexes[0],i=r.metadata[s?s.path:t];this.columnAxis=r,this.rowAxis=n,this.data=e,this.rowLength=i?i.maxChildren+i.maxMembers:r.measures.length||1,this.rowLength||(this.rowLength=1);var a=this._tbody(),o=this._colGroup();return[vt("table",{className:oe},[o,a])]},_colGroup:function(){var e=this.columnAxis.measures.length||1,t=[],r=0;for(this.rows[0]&&(e=this.rows[0].children.length);r<e;r++)t.push(vt("col",null));return vt("colgroup",null,t)},_tbody:function(){return this.rows=[],this.data[0]?(this.columnIndexes=this._indexes(this.columnAxis,this.rowLength),this.rowIndexes=this._indexes(this.rowAxis,Math.ceil(this.data.length/this.rowLength)),this._buildRows()):this.rows.push(vt("tr",{className:ne},[vt("td",{className:ce},[_t("&nbsp;")])])),vt("tbody",{className:le},this.rows)},_indexes:function(e,r){var n,s,i,a,o,l=[],c=e.indexes,u=e.metadata,h=e.measures,d=h.length||1,m=0,p=0,f=0,g=c.length;if(!g){for(i=0;i<d;i++)l[i]={index:i,measure:h[i],tuple:null};return l}for(;f<g;f++){if(o=0,(a=(s=u[(n=c[f]).path]).children+s.members)&&(a-=d),!1===s.expanded&&s.children!==s.maxChildren&&(o=s.maxChildren),s.parentMember&&s.levelNum===s.rootLevelNum&&(a=-1),a>-1){for(i=0;i<d;i++)a+i,s.children||p,l[a+p+i]={children:a,index:m,measure:h[i],tuple:n.tuple},m+=1;for(;l[p]!==t;)p+=1}if(p===r)break;m+=o}return l},_buildRows:function(){for(var e=this.rowIndexes,t=e.length,r=0;r<t;r++){var n=e[r];n&&this.rows.push(this._buildRow(n))}},_buildRow:function(e){for(var r,n,s,i,a,o,l,c=e.index*this.rowLength,u=this.columnIndexes,h=u.length,d=[],m=0;m<h;m++)(r=u[m])!==t&&(a={className:ce},r.children&&(a.className+=" k-alt"),i="",o=this.data[c+r.index],l=r.measure||e.measure,n={columnTuple:r.tuple,rowTuple:e.tuple,measure:l,dataItem:o},""!==o.value&&l&&l.type&&("status"===l.type?i=this.kpiStatusTemplate(n):"trend"===l.type&&(i=this.kpiTrendTemplate(n))),i||(i=this.dataTemplate(n)),(s=vt("td",a,[_t(i)])).value=o.value,d.push(s));return a={className:ne},e.children&&(a.className+=" k-grid-footer"),vt("tr",a,d)}});n.plugin(gt),r.PivotExcelExporter=r.Class.extend({init:function(e){this.options=e,this.widget=e.widget,this.dataSource=this.widget.dataSource},_columns:function(){var e,t=this.widget.columnsHeaderTree.children[0],r=this.widget.rowsHeaderTree.children[0],n=t.children[0].children.length,s=r.children[0].children.length,i=this.widget.options.columnWidth,a=[];if(s&&this.dataSource.data()[0])for(e=0;e<s;e++)a.push({autoWidth:!0});for(e=0;e<n;e++)a.push({autoWidth:!1,width:i});return a},_cells:function(e,t,r){for(var n,s,i,a,o,l=[],c=0,u=e.length;c<u;c++){for(s=[],n=(i=e[c].children).length,a=0;a<n;a++)o=i[a],s.push({background:"#7a7a7a",color:"#fff",value:o.value,colSpan:o.attr.colSpan||1,rowSpan:o.attr.rowSpan||1});r&&r(s,c),l.push({cells:s,type:t})}return l},_rows:function(){var e=this.widget.columnsHeaderTree.children[0],t=this.widget.rowsHeaderTree.children[0],r=e.children[0].children.length,n=t.children[0].children.length,s=e.children[1].children,i=t.children[1].children,a=this.widget.contentTree.children[0].children[1].children,o=this._cells(s,"header");n&&o[0].cells.splice(0,0,{background:"#7a7a7a",color:"#fff",value:"",colSpan:n,rowSpan:s.length});var l=this._cells(i,"data",(function(e,t){for(var n,s,i=0,o=a[t].children;i<r;i++)n=o[i],s=Number(n.value),isNaN(s)&&(s=n.value),e.push({background:"#dfdfdf",color:"#333",value:s,colSpan:1,rowSpan:1})}));return o.concat(l)},_freezePane:function(){var e=this.widget.columnsHeaderTree.children[0];return{colSplit:this.widget.rowsHeaderTree.children[0].children[0].children.length,rowSplit:e.children[1].children.length}},workbook:function(){var t;return this.dataSource.view()[0]?(t=e.Deferred()).resolve():t=this.dataSource.fetch(),t.then(function(){return{sheets:[{columns:this._columns(),rows:this._rows(),freezePane:this._freezePane(),filter:null}]}}.bind(this))}});var At={extend:function(t){t.events.push("excelExport"),t.options.excel=e.extend(t.options.excel,this.options),t.saveAsExcel=this.saveAsExcel},options:{proxyURL:"",filterable:!1,fileName:"Export.xlsx"},saveAsExcel:function(){var e=this.options.excel||{};new r.PivotExcelExporter({widget:this}).workbook().then(function(t){this.trigger("excelExport",{workbook:t})||new r.ooxml.Workbook(t).toDataURLAsync().then((function(n){r.saveAs({dataURI:n,fileName:t.fileName||e.fileName,proxyURL:e.proxyURL,forceProxy:e.forceProxy})}))}.bind(this))}};r.PivotExcelMixin=At,r.ooxml&&r.ooxml.Workbook&&At.extend(gt.prototype),r.PDFMixin&&(r.PDFMixin.extend(gt.prototype),gt.fn._drawPDF=function(){return this._drawPDFShadow({width:this.wrapper.width()},{avoidLinks:this.options.pdf.avoidLinks})}),r.PDFMixin&&(r.PDFMixin.extend(ft.prototype),ft.fn._drawPDF=function(){return this._drawPDFShadow({width:this.wrapper.width()},{avoidLinks:this.options.pdf.avoidLinks})})}(window.kendo.jQuery);var kendo$1=kendo;export{kendo$1 as default};
//# sourceMappingURL=kendo.pivotgrid.js.map
